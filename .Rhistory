print(tcilowAbundancePhylaPie)
dev.off()
}
if(plotSVG){
tcihighAbundancePhylaPiePath<-paste(plotsPath,"tcihighAbundancePhylaPie.svg", sep="")
svg(tcihighAbundancePhylaPiePath)
print(tcihighAbundancePhylaPie)
dev.off()
tcilowAbundancePhylaPiePath<-paste(plotsPath,"tcilowAbundancePhylaPie.svg", sep="")
svg(tcilowAbundancePhylaPiePath)
print(tcilowAbundancePhylaPie)
dev.off()
}
library(ggplot2)
library(dplyr)
library(vegan)
library(reshape2)
#Private functions
#
#
# with minor modifications from Analytical Methods Using R and Excel
# by: Mark Gardener
# http://www.gardenersown.co.uk/Education/Lectures/Community%20Ecology%20Support%20Files.htm
#
#
####################################################
#significance test of differences in deviance of RAD models
rad_test<-function (x, conf.level = 0.95, log = TRUE)
{
if (inherits(x, what = "radfit.frame") == FALSE)
stop("\nInput must be the result of a radfit command\n")
d <- sapply(x, function(y) unlist(lapply(y$models, deviance)))
a <- sapply(x, function(y) unlist(lapply(y$models, AIC)))
dev <- t(d)
dev <- as.data.frame(dev)
dev <- stack(dev)
names(dev) <- c("deviance", "model")
#levels(dev$model) <- c("Log", "Mb", "BS", "Pre", "Zip")
if (log == TRUE)
dev.aov <- aov(log(deviance) ~ model, data = dev)
else dev.aov <- aov(deviance ~ model, data = dev)
dev.hsd <- TukeyHSD(dev.aov, ordered = TRUE, conf.level = conf.level)
result <- list(original = dev, aov = dev.aov, post.hoc = dev.hsd,
aic = a, deviance = d, log = log, conf.level = conf.level)
class(result) <- "rad.htest"
invisible(result)
}
print.rad.test<-function (x, ...)
{
devmean <- apply(x$deviance, MARGIN = 1, FUN = mean)
devstdv <- apply(x$deviance, MARGIN = 1, FUN = sd)
devSE <- devstdv/sqrt(ncol(x$deviance))
aicmean <- apply(x$aic, MARGIN = 1, FUN = mean)
result <- rbind(devmean, devSE, aicmean)
rownames(result) <- c("Mean deviance", "SE of deviance",
"Mean AIC")
print(result, ...)
}
plot.rad.test<-function (x, which = "original", las = 1, ...)
{
WHICH <- c("original", "post.hoc")
which <- tolower(which)
which <- match.arg(which, WHICH)
bpm <- x$original$model
#bpm <- reorder(x$original$model, -x$original$deviance, FUN = mean)
if (which == "original") {
if (x$log == TRUE)
boxplot(log(deviance) ~ bpm, data = x$original,
las = las, ...)
else boxplot(deviance ~ bpm, data = x$original, las = las,
...)
}
if (which == "post.hoc") {
plot(x$post.hoc, las = las, ...)
}
}
summary.rad.htest<-function (x, ...)
{
saov <- summary(x$aov)
phoc <- x$post.hoc$model
result <- list(ANOVA = saov, Tukey = phoc, Logarithmic = x$log,
Confidence.Level = x$conf.level)
print(result, ...)
}
# Usage:
#
# This script is a companion for Vargas and Leiva.
library(ggplot2)
library(dplyr)
library(reshape2)
library(RColorBrewer)
######################
#Private functions
#
####################################################
################
#Input/Output paths
###########################
#bactLoadCorrectedCountsPath<-"./Data/cbas_tempVSctrl.otutab.bactloadCorrected_valuesOnly.csv"
uncorrectedCountsPath<-"./Data/all.otutab_raw.csv"
otuTaxonomyPath<-"./Data/all_taxa.csv"
plotsPath<-"./Figures/richnessAndAbundanceByPhylum/"
#Main Source
###########################
countsDF<-read.csv(uncorrectedCountsPath, sep="\t")
otuTaxonomy<-read.csv(otuTaxonomyPath, sep=";")
###########################
otuTaxonomy[otuTaxonomy==""]<-"Unclassified"
x<-arrange(otuTaxonomy,Phylum)
unique(x$Phylum)
#y<-arrange(all_countsWithTaxonomy)
#unique(y$Phylum)
# Colors
#Cols<-(c("yellowgreen","yellow2","wheat3","navyblue","ivory1","violetred4","violetred2","violetred","violet",
#       "turquoise4","turquoise2","turquoise","tomato3","tomato1","thistle4","thistle4","tan4","tan3","tan1",
#       "steelblue4","steelblue2","springgreen4","springgreen2","slategray2","slategray","slateblue4","salmon",
#       "royalblue","rosybrown3","red2","purple4","purple","plum3","orange"))
#names(Cols)<-levels(otuTaxonomy$Phylum)
#colours_set <- scale_fill_manual(name = "Var1",values = Cols)
################
AcidobacteriotaCol<-"yellowgreen"
ActinobacteriotaCol<-"yellow2"
BacteroidotaCol<-"wheat3"
BdellovibrionotaCol<-"navyblue"
CalditrichotaCol<-"ivory1"
CampylobacterotaCol<-"violetred4"
ChloroflexiCol<-"violetred2"
CrenarchaeotaCol<-"violetred"
CyanobacteriaCol<-"violet"
DadabacteriaCol<-"turquoise4"
DeferrisomatotaCol<-"turquoise2"
DeinococcotaCol<-"turquoise"
DependentiaeCol<-"tomato3"
DesulfobacterotaCol<-"tomato1"
EntotheonellaeotaCol<-"thistle4"
FirmicutesCol<-"thistle4"
FusobacteriotaCol<-"tan4"
GemmatimonadotaCol<-"tan3"
HydrogenedentesCol<-"tan1"
LatescibacterotaCol<-"steelblue4"
MyxococcotaCol<-"steelblue2"
NB1jCol<-"springgreen4"
NitrospinotaCol<-"springgreen2"
NitrospirotaCol<-"slategray2"
PAUC34fCol<-"slategray"
PlanctomycetotaCol<-"slateblue4"
ProteobacteriaCol<-"salmon"
SAR324cladeCol<-"royalblue"
SpirochaetotaCol<-"rosybrown3"
SumerlaeotaCol<-"red2"
UnclassifiedCol<-"purple4"
VerrucomicrobiotaCol<-"purple"
WPS2Col<-"plum3"
WS1Col<-"orange"
######
################
####################
allBacteriaColorVector<-c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,
UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col)
#################
plotSVG<-TRUE
plotPDF<-FALSE
#Summary columns for counts of each sp (every 7 columns, start function at column 2 and make the last one form 16)
dim(countsDF)
x<-sapply(seq(2,16,by=7),function(i) rowSums(countsDF[,i:(i+6)]))
#add them to DF
countsDF<-cbind(countsDF, x)
#Suma all columns and add
allSum<-apply(countsDF[,2:22],1,sum)
countsDF<-cbind(countsDF,allSum)
#rename cols
names(countsDF)
countsDF<-rename(countsDF,sumTau="1",sumTme="2",sumTci="3")
#Make cumulative percentage to filter out OTUs which make up less than the 5% cummulative sample count
pct<-allSum/sum(allSum)
countsDF<-cbind(countsDF, pct)
countsDF<-countsDF%>%
mutate(cumpct=cumsum(pct))
dim(countsDF)
#bind the taxonomy columns to the otu counts DF
countsWithTaxonomy<-bind_cols(countsDF[order(countsDF$X.OTU.ID),], otuTaxonomy[order(otuTaxonomy$sequence_identifier),])
#Filter up to 95 % additive abundance
countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$cumpct < 0.95,]
dim(countsWithTaxonomy)
#delete column again
countsWithTaxonomy=select(countsWithTaxonomy,-cumpct)
#remove OTUs with sum zero for all species
dim(countsWithTaxonomy)
all_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$allSum!=0,]
#remove OTUs with sum zero for Tau
tau_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$sumTau!=0,]
dim(tau_countsWithTaxonomy)#912
#remove OTUs with sum zero for Tme
tme_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$sumTme!=0,]
dim(tme_countsWithTaxonomy)#257
#remove OTUs with sum zero for Tci
tci_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$sumTci!=0,]
dim(tci_countsWithTaxonomy)#2240
#######################
#
# OTU Richness by Phylum
#FOR ALL SPECIES
#
###########################################
#get a table with the number of OTUs annotated to each phylum for all sp
phylumRichness<-table(all_countsWithTaxonomy$Phylum)
allsp_allPhylaRichnessPie<-ggplot(as.data.frame(phylumRichness), aes(x="", y=Freq,fill=Var1)) + geom_bar(stat = "identity") + coord_polar("y") +scale_fill_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,
UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col))+ theme_bw()
allsp_allPhylaRichnessPie
allsp_allPhylaRichnessPie
###########################################
#
# Usage:
#
# This script is a companion for Vargas and Leiva.
library(ggplot2)
library(dplyr)
library(reshape2)
library(RColorBrewer)
######################
#Private functions
#
####################################################
################
#Input/Output paths
###########################
#bactLoadCorrectedCountsPath<-"./Data/cbas_tempVSctrl.otutab.bactloadCorrected_valuesOnly.csv"
uncorrectedCountsPath<-"./Data/all.otutab_raw.csv"
otuTaxonomyPath<-"./Data/all_taxa.csv"
plotsPath<-"./Figures/richnessAndAbundanceByPhylum/"
#Main Source
###########################
countsDF<-read.csv(uncorrectedCountsPath, sep="\t")
otuTaxonomy<-read.csv(otuTaxonomyPath, sep=";")
###########################
otuTaxonomy[otuTaxonomy==""]<-"Unclassified"
x<-arrange(otuTaxonomy,Phylum)
unique(x$Phylum)
#y<-arrange(all_countsWithTaxonomy)
#unique(y$Phylum)
# Colors
#Cols<-(c("yellowgreen","yellow2","wheat3","navyblue","ivory1","violetred4","violetred2","violetred","violet",
#       "turquoise4","turquoise2","turquoise","tomato3","tomato1","thistle4","thistle4","tan4","tan3","tan1",
#       "steelblue4","steelblue2","springgreen4","springgreen2","slategray2","slategray","slateblue4","salmon",
#       "royalblue","rosybrown3","red2","purple4","purple","plum3","orange"))
#names(Cols)<-levels(otuTaxonomy$Phylum)
#colours_set <- scale_fill_manual(name = "Var1",values = Cols)
################
AcidobacteriotaCol<-"yellowgreen"
ActinobacteriotaCol<-"yellow2"
BacteroidotaCol<-"wheat3"
BdellovibrionotaCol<-"navyblue"
CalditrichotaCol<-"ivory1"
CampylobacterotaCol<-"violetred4"
ChloroflexiCol<-"violetred2"
CrenarchaeotaCol<-"violetred"
CyanobacteriaCol<-"violet"
DadabacteriaCol<-"turquoise4"
DeferrisomatotaCol<-"turquoise2"
DeinococcotaCol<-"turquoise"
DependentiaeCol<-"tomato3"
DesulfobacterotaCol<-"tomato1"
EntotheonellaeotaCol<-"thistle4"
FirmicutesCol<-"thistle4"
FusobacteriotaCol<-"tan4"
GemmatimonadotaCol<-"tan3"
HydrogenedentesCol<-"tan1"
LatescibacterotaCol<-"steelblue4"
MyxococcotaCol<-"steelblue2"
NB1jCol<-"springgreen4"
NitrospinotaCol<-"springgreen2"
NitrospirotaCol<-"slategray2"
PAUC34fCol<-"slategray"
PlanctomycetotaCol<-"slateblue4"
ProteobacteriaCol<-"salmon"
SAR324cladeCol<-"royalblue"
SpirochaetotaCol<-"rosybrown3"
SumerlaeotaCol<-"red2"
UnclassifiedCol<-"purple4"
VerrucomicrobiotaCol<-"purple"
WPS2Col<-"plum3"
WS1Col<-"orange"
######
################
####################
allBacteriaColorVector<-c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,
UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col)
#################
plotSVG<-TRUE
plotPDF<-FALSE
#Summary columns for counts of each sp (every 7 columns, start function at column 2 and make the last one form 16)
dim(countsDF)
x<-sapply(seq(2,16,by=7),function(i) rowSums(countsDF[,i:(i+6)]))
#add them to DF
countsDF<-cbind(countsDF, x)
#Suma all columns and add
allSum<-apply(countsDF[,2:22],1,sum)
countsDF<-cbind(countsDF,allSum)
#rename cols
names(countsDF)
countsDF<-rename(countsDF,sumTau="1",sumTme="2",sumTci="3")
#Make cumulative percentage to filter out OTUs which make up less than the 5% cummulative sample count
pct<-allSum/sum(allSum)
countsDF<-cbind(countsDF, pct)
countsDF<-countsDF%>%
mutate(cumpct=cumsum(pct))
dim(countsDF)
#bind the taxonomy columns to the otu counts DF
countsWithTaxonomy<-bind_cols(countsDF[order(countsDF$X.OTU.ID),], otuTaxonomy[order(otuTaxonomy$sequence_identifier),])
#Filter up to 95 % additive abundance
countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$cumpct < 0.95,]
dim(countsWithTaxonomy)
#delete column again
countsWithTaxonomy=select(countsWithTaxonomy,-cumpct)
#remove OTUs with sum zero for all species
dim(countsWithTaxonomy)
all_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$allSum!=0,]
#remove OTUs with sum zero for Tau
tau_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$sumTau!=0,]
dim(tau_countsWithTaxonomy)#912
#remove OTUs with sum zero for Tme
tme_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$sumTme!=0,]
dim(tme_countsWithTaxonomy)#257
#remove OTUs with sum zero for Tci
tci_countsWithTaxonomy<-countsWithTaxonomy[countsWithTaxonomy$sumTci!=0,]
dim(tci_countsWithTaxonomy)#2240
#######################
#
# OTU Richness by Phylum
#FOR ALL SPECIES
#
###########################################
#get a table with the number of OTUs annotated to each phylum for all sp
phylumRichness<-table(all_countsWithTaxonomy$Phylum)
allsp_allPhylaRichnessPie<-ggplot(as.data.frame(phylumRichness), aes(x="", y=Freq,fill=Var1)) + geom_bar(stat = "identity") + coord_polar("y") +scale_fill_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,
UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col))+ theme_bw()
allsp_allPhylaRichnessPie
highRichnessPhyla<-phylumRichness[phylumRichness>10]
names(highRichnessPhyla)
allsp_highRichnessPhylaPie<-ggplot(as.data.frame(highRichnessPhyla), aes(x="", y=Freq, fill=Var1)) +
geom_bar(stat = "identity") + coord_polar("y") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,
BdellovibrionotaCol, ChloroflexiCol,CyanobacteriaCol, DesulfobacterotaCol,
GemmatimonadotaCol,LatescibacterotaCol,MyxococcotaCol,NB1jCol, PlanctomycetotaCol,
ProteobacteriaCol, UnclassifiedCol, VerrucomicrobiotaCol)) + theme_bw()
lowRichnessPhyla<-phylumRichness[phylumRichness<=10]
names(lowRichnessPhyla)
allsp_lowRichnessPhylaPie<-ggplot(as.data.frame(lowRichnessPhyla), aes(x="", y=Freq, fill=Var1)) +
geom_bar(stat = "identity") + coord_polar("y") +
scale_fill_manual(values = c(CalditrichotaCol,CampylobacterotaCol,CrenarchaeotaCol,DadabacteriaCol,DeferrisomatotaCol,
DeinococcotaCol,DependentiaeCol,EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,HydrogenedentesCol,
NitrospinotaCol,NitrospirotaCol,PAUC34fCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,WPS2Col,WS1Col)) +
theme_bw()
??ggsave
allspeciesrichnessplots<-list(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie)
ggsave("allspeciesrichnessplots.pdf", marrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=1))
ggsave("allspeciesrichnessplots.pdf", arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=1))
library(gridExtra)
install.packages(gridExtra)
install.packages("gridExtra")
library(gridExtra)
ggsave("allspeciesrichnessplots.pdf", arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=1))
ggsave("allspeciesrichnessplots.jpg", plotPath, arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=1))
ggsave("allspeciesrichnessplots.jpg", path=plotPath, arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=1))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=1))
##Combine allsp_ richness plots together
legend<-get_legend(allsp_allPhylaRichnessPie)
install.packages("cowplot")
library(cowplot)
##Combine allsp_ richness plots together
legend<-get_legend(allsp_allPhylaRichnessPie)
allsp_allPhylaRichnessPie<-allsp_allPhylaRichnessPie+legend_position(none)
allsp_allPhylaRichnessPie<-allsp_allPhylaRichnessPie+theme(legend.position="none")
phylumCounts<-all_countsWithTaxonomy %>% group_by(Phylum) %>% summarise(sum=sum(allSum))
head(phylumCounts$Phylum)
allsp_allPhylaAbundancePie<-ggplot(phylumCounts, aes(x="", y=sum, fill=Phylum)) + geom_bar(stat = "identity") + coord_polar("y") + scale_fill_manual(values = allBacteriaColorVector) + theme_bw()
allsp_allPhylaAbundancePie
#split in high and low abundance
highCountsPhyla<-phylumCounts[phylumCounts$sum > 1000,]
lowCountsPhyla<-phylumCounts[phylumCounts$sum <= 1000,]
unique(highCountsPhyla$Phylum)
#plot
allsp_highAbundancePhylaPie<-ggplot(highCountsPhyla, aes(x="", y=sum, fill=Phylum)) + geom_bar(stat = "identity") + coord_polar("y") + scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,CrenarchaeotaCol,CyanobacteriaCol,
DesulfobacterotaCol,PlanctomycetotaCol,ProteobacteriaCol,UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw()
unique(lowCountsPhyla$Phylum)
allsp_lowAbundancePhylaPie<-ggplot(lowCountsPhyla, aes(x="", y=sum, fill=Phylum)) + geom_bar(stat = "identity") + coord_polar("y") + scale_fill_manual(values = c(BdellovibrionotaCol,CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,DadabacteriaCol,DeferrisomatotaCol,
DeinococcotaCol,DependentiaeCol,EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,
get a table with the number of OTUs annotated to each phylum for all sp
tauphylumRichness<-table(tau_countsWithTaxonomy$Phylum)
dim(tauphylumRichness)
names(tauphylumRichness)
tau_allPhylaRichnessPie<-ggplot(as.data.frame(phylumRichness), aes(x="", y=Freq, fill=Var1)) + geom_bar(stat = "identity") + coord_polar("y") +scale_fill_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,
tauhighRichnessPhyla<-tauphylumRichness[tauphylumRichness>10]
names(tauhighRichnessPhyla)
tauhighRichnessPhylaPie<-ggplot(as.data.frame(tauhighRichnessPhyla), aes(x="", y=Freq, fill=Var1)) + geom_bar(stat = "identity") + coord_polar("y") + scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,MyxococcotaCol,
NB1jCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol, VerrucomicrobiotaCol)) + theme_bw()
tauhighRichnessPhylaPie
taulowRichnessPhyla<-tauphylumRichness[tauphylumRichness<=10]
names(taulowRichnessPhyla)
taulowRichnessPhylaPie<-ggplot(as.data.frame(taulowRichnessPhyla), aes(x="", y=Freq, fill=Var1)) +
geom_bar(stat = "identity") + coord_polar("y") +
scale_fill_manual(values = c(BdellovibrionotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,
CyanobacteriaCol,DadabacteriaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,
LatescibacterotaCol,NitrospinotaCol,NitrospirotaCol,SAR324cladeCol)) +
theme_bw()
#get abundance by phylum
tauphylumCounts<-tau_countsWithTaxonomy %>% group_by(Phylum) %>% summarise(sum=sum(sumTau))
head(tauphylumCounts$Phylum)
tauPhylaAbundancePie<-ggplot(tauphylumCounts, aes(x="", y=sum, fill=Phylum)) + geom_bar(stat = "identity") + coord_polar("y") + scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
#get abundance by phylum
phylumCounts<-all_countsWithTaxonomy %>% group_by(Phylum) %>% summarise(sum=sum(allSum))
head(phylumCounts$Phylum)
allsp_allPhylaRichnessPie<-allsp_allPhylaRichnessPie+theme(legend.position="none")
allsp_highPhylaRichnessPie<-allsp_highPhylaRichnessPie+theme(legend.position="none")
allsp_highRichnessPhylaPie<-allsp_highRichnessPhylaPie+theme(legend.position="none")
allsp_lowRichnessPhylaPie<-allsp_lowRichnessPhylaPie+theme(legend.position="none")
allspecies_richnessplots<-list(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=2,byrow=FALSE))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, arrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=2))
allsp_allPhylaRichnessPie
allsp_highRichnessPhylaPie
allsp_lowRichnessPhylaPie
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, marrangeGrob(grobs = allspeciesrichnessplots, nrow=3, ncol=2,byrow=FALSE))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspeciesrichnessplots, layout_matrix=rbind(c(1,2,),c(3,4))))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspeciesrichnessplots, layout_matrix=rbind(c(1,2),c(3,4))))
allspecies_richnessplots<-list(allsp_allPhylaRichnessPie+theme(legend.position="none"),allsp_highRichnessPhylaPie+theme(legend.position="none"),allsp_lowRichnessPhylaPie+theme(legend.position="none"),legend)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspeciesrichnessplots, layout_matrix=rbind(c(1,2),c(3,4))))
#plot
tcihighAbundancePhylaPie<-ggplot(tcihighCountsPhyla, aes(x="", y=sum, fill=Phylum)) + geom_bar(stat = "identity",show.legend=FALSE) + coord_polar("y") + scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,CrenarchaeotaCol,CyanobacteriaCol,
DesulfobacterotaCol,PlanctomycetotaCol,ProteobacteriaCol,UnclassifiedCol)) + theme_bw()
allsp_highRichnessPhylaPie<-ggplot(as.data.frame(highRichnessPhyla), aes(x="", y=Freq, fill=Var1)) +
geom_bar(stat = "identity",show.legend=FALSE) + coord_polar("y") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,
BdellovibrionotaCol, ChloroflexiCol,CyanobacteriaCol, DesulfobacterotaCol,
GemmatimonadotaCol,LatescibacterotaCol,MyxococcotaCol,NB1jCol, PlanctomycetotaCol,
ProteobacteriaCol, UnclassifiedCol, VerrucomicrobiotaCol)) + theme_bw()
allsp_lowRichnessPhylaPie<-ggplot(as.data.frame(lowRichnessPhyla), aes(x="", y=Freq, fill=Var1)) +
geom_bar(stat = "identity",show.legend=FALSE) + coord_polar("y") +
scale_fill_manual(values = c(CalditrichotaCol,CampylobacterotaCol,CrenarchaeotaCol,DadabacteriaCol,DeferrisomatotaCol,
DeinococcotaCol,DependentiaeCol,EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,HydrogenedentesCol,
NitrospinotaCol,NitrospirotaCol,PAUC34fCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,WPS2Col,WS1Col)) +
theme_bw()
#Get legend
legend<-get_legend(allsp_allPhylaRichnessPie)
#Remove legend from plot
allsp_allPhylaRichnessPie<-ggplot(as.data.frame(phylumRichness), aes(x="", y=Freq,fill=Var1)) + geom_bar(stat = "identity",show.legend=FALSE) +
coord_polar("y") +scale_fill_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol, CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col))+ theme_bw()
allspecies_richnessplots<-list(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspeciesrichnessplots, layout_matrix=rbind(c(1,2),c(3,4))))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots, layout_matrix=rbind(c(1,2),c(3,4))))
allspecies_richnessplots<-matrix(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend)
allspecies_richnessplots<-matrix(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend)
??matrix
allspecies_richnessplots<-matrix(rbind(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots, layout_matrix=rbind(c(1,2),c(3,4))))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots))
allspecies_richnessplots<-list(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,ncol=2),legend,ncol=1)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,ncol=2),legend)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,ncol=2))
allspecies_richnessplots<-list(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,ncol=2,byrow=FALSE))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,ncol=2),byrow=FALSE)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots),ncol=2,byrow=FALSE)
allsp_allPhylaRichnessPie<-ggplot(as.data.frame(phylumRichness), aes(x="", y=Freq,fill=Var1)) + geom_bar(stat = "identity") + coord_polar("y") +scale_fill_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,
UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col))+ theme_bw()
#Get legend
legend<-get_legend(allsp_allPhylaRichnessPie)
#Remove legend from plot
allsp_allPhylaRichnessPie<-ggplot(as.data.frame(phylumRichness), aes(x="", y=Freq,fill=Var1)) + geom_bar(stat = "identity",show.legend=FALSE) +
coord_polar("y") +scale_fill_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol, CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col))+ theme_bw()
allspecies_richnessplots<-list(allsp_allPhylaRichnessPie,allsp_highRichnessPhylaPie,allsp_lowRichnessPhylaPie,legend)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots),ncol=2,byrow=FALSE)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots),by_row=FALSE)
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,layout_matrix=c(1,2,3,4)))
??grid.arrange
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,layout_matrix=rbind(c(1,2,3,4) ))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,layout_matrix=rbind(c(1,2,3,4)))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,layout_matrix=rbind(c(1,2,3,4))))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,layout_matrix=rbind(c(1,2,3,NA),c(NA,NA,NA,4))))
ggsave("allspeciesrichnessplots.jpg", path=plotsPath, grid.arrange(grobs = allspecies_richnessplots,layout_matrix=rbind(c(1,2,3,4),c(NA,NA,NA,4))))
