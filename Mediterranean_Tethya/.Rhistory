group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
dim(xdatamelt)
head(xdatamelt)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(datamelt,xdatamelt[2])
#DAta with just the core OTUs and also with just non core OTUs
##core
coredata<-xdata[xdata$X.OTU.ID %in% core_community$X.OTU.ID,]
head(coredata)
coredatamelt<-melt(coredata[-c(1,46,47,49:53)])
levels(coredatamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(coredatamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
##for core dataset
#Group by species and calc relative abundance of each OTU for each species
xcoredatamelt<-coredatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
coredataset<-cbind(coredatamelt,xcoredatamelt[2])
##non-core
noncoredata<-xdata[!(xdata$X.OTU.ID %in% core_community$X.OTU.ID),]#HEREEE
noncoredatamelt<-melt(noncoredata[-c(1,46,47,49:53)])
#
levels(noncoredatamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(noncoredatamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
##REpeat for noncore dataset
#Group by species and calc relative abundance of each OTU for each species
xnoncoredatamelt<-noncoredatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
noncoredataset<-cbind(noncoredatamelt,xnoncoredatamelt[2])
unique(dataset$Phylum)
################
AcidobacteriotaCol<-"yellowgreen"
ActinobacteriotaCol<-"yellow2"
BacteroidotaCol<-"wheat3"
#BdellovibrionotaCol<-"navyblue"
CalditrichotaCol<-"tomato3"
#CampylobacterotaCol<-"ivory1"
ChloroflexiCol<-"violetred2"
CrenarchaeotaCol<-"violetred"
CyanobacteriaCol<-"violet"
DadabacteriaCol<-"turquoise4"
DeferrisomatotaCol<-"turquoise3"
DeinococcotaCol<-"turquoise"
#DependentiaeCol<-"tomato3"
DesulfobacterotaCol<-"tomato1"
EntotheonellaeotaCol<-"thistle4"
#FirmicutesCol<-"black"
#FusobacteriotaCol<-"rosybrown3"
GemmatimonadotaCol<-"tan3"
#HydrogenedentesCol<-"tan1"
LatescibacterotaCol<-"steelblue4"
MyxococcotaCol<-"steelblue2"
NB1jCol<-"springgreen4"
NitrospinotaCol<-"springgreen2"
NitrospirotaCol<-"slategray2"
#PAUC34fCol<-"slateblue"
PlanctomycetotaCol<-"slategray"
ProteobacteriaCol<-"salmon"
SAR324cladeCol<-"royalblue"
SpirochaetotaCol<-"tan4"
#SumerlaeotaCol<-"red2"
UnclassifiedCol<-"purple4"
VerrucomicrobiotaCol<-"purple"
#BUbble plots
#BUbble plot for comparing, richness and abundance of phylums across species
head(dataset)
unique(dataset$Phylum)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n())
dim(otucount)
relabunds<-dataset%>%
group_by(Phylum,variable)%>%
summarise(abundance=sum(relative_abundance))
dim(relabunds)
bubbledata<-cbind(otucount,relabunds[3])
head(bubbledata)
#SHowing between phylums
bubbledata[bubbledata==0]<-NA
#Showing between species
ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.7,20))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
ggsave("./Figures/AS_16splots/all16_phylum_richness_and_abundance_bubble.jpg",path=plotsPath)
ggsave("./Figures/AS_16splots/all16_phylum_richness_and_abundance_bubble.jpg")
#Showing between species
tiff("./Figures/AS_16splots/all16_phylum_richness_and_abundance_bubble.tiff",height=30,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.7,20))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
#Showing between species
tiff("./Figures/AS_16splots/all16_phylum_richness_and_abundance_bubble.tiff",height=20,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.7,20))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
View(bubbledata)
#Visualize Otus seperately- compare abundance across phylas per sp
head(dataset)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n())
View(otucount)
relabunds<-dataset%>%
group_by(Phylum,variable)%>%
summarise(abundance=sum(relative_abundance))
bubbledata<-cbind(otucount,relabunds[3])
head(bubbledata)
View(bubbledata)
###
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
###
ggplot(dataset,aes(x=variable,y=log(relative_abundance),color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
###
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
###
tiff("./Figures/AS_16splots/all16_otu_abundance_bubble.tiff",height=30,width=30,units="cm",res=300)
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
ggplot(bubbledata,aes(x=variable,y=abundance/Numb_otu,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
View(dataset)
#FIll blank boxes with "unclassified"
names(xdata)
xdata[xdata==""]<-"Unclasssified"
#Melt data set and remove unnecassary rows
datamelt<-melt(xdata[-c(1,46,47,49:53)])
levels(datamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(datamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
#Group by species and calc relative abundance of each OTU for each species
xdatamelt<-datamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
dim(xdatamelt)
head(xdatamelt)
View(datamelt)
View(xdatamelt)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(datamelt,xdatamelt[2])
view(xdatamelt)
View(xdatamelt)
View(datamelt)
#creates a bunch of 0 values because creates a category for every OTU and sp
#so need to get rid of zero columns-make them NAs
dataset[dataset==0]<-NA
coredataset[coredataset==0]<-NA
noncoredataset[noncoredataset==0]<-NA
ggplot(dataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum),stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n())
View(otucount)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(datamelt,xdatamelt[2])
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
coredataset<-cbind(coredatamelt,xcoredatamelt[2])
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
noncoredataset<-cbind(noncoredatamelt,xnoncoredatamelt[2])
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n())%>%
complete(Phylum,variable)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n(),.drop=FALSE)
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable .drop=FALSE)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum,variable.drop=FALSE)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum.drop=FALSE,variable.drop=FALSE)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum.drop=TRUE,variable.drop=FALSE)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum.drop=TRUE,variable.drop=TRUE)%>%
summarise(Numb_otu=n())
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable.drop=TRUE)%>%
summarise(Numb_otu=n())
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n().drop=FALSE)
str(dataset)
is.factor(dataset$Phylum)
as.factor(dataset$Phylum)
unique(dataset$Phylum)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
summarise(Numb_otu=n())
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
summarise(Numb_otu=n())
View(otucount)
dataset$Phylum<-is.factor(dataset$Phylum)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
summarise(Numb_otu=n())
unique(dataset$Phylum)
#continuation from "AS_NLcoreCommunity.R" script
#BUbble plots
#BUbble plot for comparing, richness and abundance of phylums across species
head(dataset)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(datamelt,xdatamelt[2])
str(dataset)
is.factor(dataset$Phylum)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
summarise(Numb_otu=n())
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
tally()
View(otucount)
library(plyr)
library(dplyr)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
summarise(Numb_otu=n())
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
dplyr::summarise(Numb_otu=n())
View(otucount)
#continuation from "AS_NLcoreCommunity.R" script
#BUbble plots
#BUbble plot for comparing, richness and abundance of phylums across species
head(dataset)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
dplyr::add_count()
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
dplyr::count()
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable,.drop=FALSE)%>%
dplyr::count(.drop=FALSE)
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::count(.drop=FALSE)
View(otucount)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::tally(.drop=FALSE)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::taly(.drop=FALSE)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::add_tally(.drop=FALSE)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::add_count(.drop=FALSE)
otucount<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::add_count()
otucount<-dataset%>%
group_by(variable,Phylum)%>%
dplyr::add_count()
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::add_count()
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::count()
??count
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::count.tbl_lazy()
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dbplyr::count.tbl_lazy()
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dbplyr::summarize(Numb_otu=n())
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::summarize(Numb_otu=n())
otucountphylum<-dataset%>%
count(Phylum,variable)%>%
show_query()
#continuation from "AS_NLcoreCommunity.R" script
#BUbble plots
#BUbble plot for comparing, richness and abundance of phylums across species
head(dataset)
otucountphylum<-dataset%>%
count(Phylum,variable)%>%
show_query()
otucountphylum<-dataset%>%
count(Phylum,wt=variable)%>%
show_query()
otucountphylum<-dataset%>%
group_by(Phylum,variable)%>%
dplyr::summarize(count=n())
View(otucountphylum)
View(dataset)
otucountphylum<-dataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarize(count=n())
View(otucountphylum)
relabunds<-dataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
summarise(abundance=sum(relative_abundance))
dim(relabunds)
dim(otucount)
dim(otucountphylum)
relabunds<-dataset%>%
group_by(Phylum,variable)%>%
summarise(abundance=sum(relative_abundance))
dim(relabunds)
View(relabunds)
relabunds<-dataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarise(abundance=sum(relative_abundance))
bubbledata<-cbind(otucount,relabunds[3])
otucount<-dataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarize(count=n())
bubbledata<-cbind(otucount,relabunds[3])
#Showing between species
tiff("./Figures/AS_16splots/bubble_phylum_richness_and_abundance.tiff",height=20,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.7,20))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
otucount<-dataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarize(Numb_otu=n())
dim(otucount)
relabunds<-dataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarise(abundance=sum(relative_abundance))
dim(relabunds)
bubbledata<-cbind(otucount,relabunds[3])
#SHowing between phylums
bubbledata[bubbledata==0]<-NA
#Showing between species
tiff("./Figures/AS_16splots/bubble_phylum_richness_and_abundance.tiff",height=20,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.7,20))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
dataset[dataset==0]<-NA
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
View(dataset)
dataset%>%
filter(relative_abundance>1)
dataset<-dataset%>%
filter(relative_abundance>1)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(datamelt,xdatamelt[2])
dataset<-dataset%>%
filter(relative_abundance>0)
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
###
tiff("./Figures/AS_16splots/bubble_otu_abundance.tiff",height=30,width=30,units="cm",res=300)
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
#Abundance divided by richness
tiff("./Figures/AS_16splots/bubble_phyla_abundance_dividedby_richness.tiff",height=20,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=abundance/Numb_otu,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance/Phylum richness")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"))
dev.off()
