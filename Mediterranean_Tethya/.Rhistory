filter(sumtau>=0.90)%>%
mutate("which_sp"="T. au")#9core
nrow(cc_tau)
cc_tme<-OTUPresence%>%
filter(sumtme>=0.90)%>%
mutate("which_sp"="T. me")#6 core
nrow(cc_tme)
cc_tci<-OTUPresence%>%
filter(sumtci>=0.90)%>%
mutate("which_sp"="T. ci")#48   core
nrow(cc_tci)
#Combinations of shared core bacteria
#Tau and Tme
cc_tau_tme<-OTUPresence%>%
filter(sumtau>=0.90 & sumtme>=0.90 )#6 shared
#Tau and Tci
cc_tau_tci<-OTUPresence%>%
filter(sumtau>=0.90 & sumtci>=0.90 )#5 shared
#Tme and Tci
cc_tme_tci<-OTUPresence%>%
filter(sumtme>=0.90 & sumtci>=0.90 )#4 shared
#Ven Diagram
library(VennDiagram)
#FIll blank boxes with "unclassified"
head(xdata)
xdata[xdata==""]<-"Unclasssified"
unique(xdata$Phylum)
ydata<-xdata%>%
rowwise() %>%
mutate(
sumtau = sum(c_across(c(2:12,45))),
sumtme = sum(c_across(c(13:23,43,44))),
sumtci = sum(c_across(24:42))
)
ydata<-ydata[,c(46,48,54:56)]
ydatamelt<-melt(ydata)
head(ydatamelt)
levels(ydatamelt$variable)<-c("sumtau","sumtme","sumtci")
levels(ydatamelt$variable)<-c("Tau","Tme","Tci")
#Group by species and calc relative abundance of each OTU for each species
###THE ISSUE HERE
xdatamelt<-ydatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
dim(xdatamelt)
head(xdatamelt)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(ydatamelt,xdatamelt[2])
#DAta with just the core OTUs and also with just non core OTUs
##core
coredata<-xdata[xdata$X.OTU.ID %in% core_community$X.OTU.ID,]
#DAta with just the core OTUs and also with just non core OTUs
##core
coredata<-xdata[xdata$X.OTU.ID %in% core_community$X.OTU.ID,]
coredatamelt1<-coredata%>%
rowwise() %>%
mutate(
tau = sum(c_across(c(2:12,45))),
tme = sum(c_across(c(13:23,43,44))),
tci = sum(c_across(24:42))
)
View(coredatamelt1)
coredatamelt2<-melt(coredatamelt1[,c(1,46,48,54:57)])
coredatamelt2<-melt(coredatamelt1[,c(1,46,48,54:56)])
dim(coredatamelt2)
OTUpresence<-as.data.frame(coredata[,2:45]>0)#turns into logical value, true or false if present or not
cclimits<-OTUpresence%>%
rowwise() %>%
mutate(
sumtau = sum(c_across(c(2:12,45))/12),
sumtme = sum(c_across(c(13:23,43,44))/13),
sumtci = sum(c_across(24:42)/19))
OTUpresence<-cbind(coredata[,1],OTUpresence)
cclimits<-OTUpresence%>%
rowwise() %>%
mutate(
sumtau = sum(c_across(c(2:12,45))/12),
sumtme = sum(c_across(c(13:23,43,44))/13),
sumtci = sum(c_across(24:42)/19))
cclimits2<-cclimits[,c(1,46:48)]
cclimitmelt<-melt(cclimits2)
dim(cclimitmelt)
names(cclimitmelt)[names(cclimitmelt) == 'value'] <- 'limit'
names(cclimitmelt)[names(cclimitmelt) == 'variable'] <- 'sample'
coredatacomb<-cbind(coredatamelt2,cclimitmelt)
coredatamelt<-coredatacomb%>%
filter(limit>=0.9)
coredatamelt<-coredatamelt[,-c(6:8)]
head(coredatamelt)
dim(coredatamelt)
OTUpresence
cclimits
cclimits2<-cclimits[,c(1,46:48)]
cclimitmelt<-melt(cclimits2)
coredatacomb<-cbind(coredatamelt2,cclimitmelt)
names(cclimitmelt)[names(cclimitmelt) == 'variable'] <- 'sample'
coredatacomb<-cbind(coredatamelt2,cclimitmelt)
coredatamelt<-coredatacomb%>%
filter(limit>=0.9)
OTUpresence<-cbind(coredata[,1],OTUpresence)
#DAta with just the core OTUs and also with just non core OTUs
##core
coredata<-xdata[xdata$X.OTU.ID %in% core_community$X.OTU.ID,]
coredatamelt1<-coredata%>%
rowwise() %>%
mutate(
tau = sum(c_across(c(2:12,45))),
tme = sum(c_across(c(13:23,43,44))),
tci = sum(c_across(24:42))
)
View(coredatamelt1)
coredatamelt2<-melt(coredatamelt1[,c(1,46,48,54:56)])
dim(coredatamelt2)
OTUpresence<-as.data.frame(coredata[,2:45]>0)#turns into logical value, true or false if present or not
OTUpresence<-cbind(coredata[,1],OTUpresence)
cclimits<-OTUpresence%>%
rowwise() %>%
mutate(
sumtau = sum(c_across(c(2:12,45))/12),
sumtme = sum(c_across(c(13:23,43,44))/13),
sumtci = sum(c_across(24:42)/19))
cclimits2<-cclimits[,c(1,46:48)]
cclimitmelt<-melt(cclimits2)
dim(cclimitmelt)
names(cclimitmelt)[names(cclimitmelt) == 'value'] <- 'limit'
names(cclimitmelt)[names(cclimitmelt) == 'variable'] <- 'sample'
coredatacomb<-cbind(coredatamelt2,cclimitmelt)
coredatamelt<-coredatacomb%>%
filter(limit>=0.9)
coredatamelt
coredatamelt1<-coredata%>%
rowwise() %>%
mutate(
tau = sum(c_across(c(2:12,45))),
tme = sum(c_across(c(13:23,43,44))),
tci = sum(c_across(24:42))
)
coredatamelt2<-melt(coredatamelt1[,c(1,46,48,54:56)])
dim(coredatamelt2)
OTUpresence<-as.data.frame(coredata[,2:45]>0)#turns into logical value, true or false if present or not
OTUpresence<-cbind(coredata[,1],OTUpresence)
cclimits<-OTUpresence%>%
rowwise() %>%
mutate(
sumtau = sum(c_across(c(2:12,45))/12),
sumtme = sum(c_across(c(13:23,43,44))/13),
sumtci = sum(c_across(24:42)/19))
cclimits2<-cclimits[,c(1,46:48)]
cclimitmelt<-melt(cclimits2)
dim(cclimitmelt)
names(cclimitmelt)[names(cclimitmelt) == 'value'] <- 'limit'
names(cclimitmelt)[names(cclimitmelt) == 'variable'] <- 'sample'
coredatacomb<-cbind(coredatamelt2,cclimitmelt)
coredatamelt<-coredatacomb%>%
filter(limit>=0.9)
View(coredatamelt)
coredatamelt<-coredatamelt[,-c(2,6:8)]
head(coredatamelt)
dim(coredatamelt)
#Set levels
levels(coredatamelt$variable)<-c("sumtau","sumtme","sumtci")
levels(coredatamelt$variable)<-c("Tau","Tme","Tci")
##for core dataset
#Group by species and calc relative abundance of each OTU for each species
xcoredatamelt<-coredatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
coredataset<-cbind(coredatamelt,xcoredatamelt[2])
##non-core
noncoredata<-xdata[!(xdata$X.OTU.ID %in% coredataset$X.OTU.ID),]#HEREEE
OTUpresence<-as.data.frame(noncoredata[,2:45]>0)#turns into logical value, true or false if present or not
OTUpresence<-cbind(noncoredata[,1],OTUpresence)
cclimits<-OTUpresence%>%
rowwise() %>%
mutate(
sumtau = sum(c_across(c(2:12,45))/12),
sumtme = sum(c_across(c(13:23,43,44))/13),
sumtci = sum(c_across(24:42)/19))
cclimits2<-cclimits[,c(1,46:48)]
cclimitmelt<-melt(cclimits2)
dim(cclimitmelt)
names(cclimitmelt)[names(cclimitmelt) == 'value'] <- 'limit'
names(cclimitmelt)[names(cclimitmelt) == 'variable'] <- 'sample'
noncoredatacomb<-cbind(ynoncoredata,cclimitmelt)
noncoredatamelt<-noncoredatacomb%>%
filter(limit>=0.9)
noncoredatamelt<-noncoredatamelt[,-c(2,6:8)]
#Set levels
levels(noncoredatamelt$variable)<-c("Tau","Tme","Tci")
##REpeat for noncore dataset
#Group by species and calc relative abundance of each OTU for each species
xnoncoredatamelt<-noncoredatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
noncoredataset<-cbind(noncoredatamelt,xnoncoredatamelt[2])
##########
unique(dataset$Phylum)
################
AcidobacteriotaCol<-"yellowgreen"
ActinobacteriotaCol<-"yellow2"
BacteroidotaCol<-"wheat3"
BdellovibrionotaCol<-"darkslategray"
CalditrichotaCol<-"tomato3"
CampylobacterotaCol<-"wheat1"
ChloroflexiCol<-"violetred2"
CrenarchaeotaCol<-"violetred"
CyanobacteriaCol<-"violet"
DadabacteriaCol<-"turquoise4"
DeferrisomatotaCol<-"turquoise3"
DeinococcotaCol<-"turquoise"
#DependentiaeCol<-"tomato3"
DesulfobacterotaCol<-"tomato1"
EntotheonellaeotaCol<-"Violetred4"
#FirmicutesCol<-"black"
#FusobacteriotaCol<-"rosybrown3"
GemmatimonadotaCol<-"tan3"
#HydrogenedentesCol<-"tan1"
LatescibacterotaCol<-"steelblue4"
MyxococcotaCol<-"steelblue2"
NB1jCol<-"springgreen4"
NitrospinotaCol<-"springgreen2"
NitrospirotaCol<-"slategray2"
PAUC34fCol<-"darkkhaki"
PlanctomycetotaCol<-"purple4"
ProteobacteriaCol<-"salmon"
SAR324cladeCol<-"royalblue"
SpirochaetotaCol<-"tan4"
#SumerlaeotaCol<-"red2"
UnclassifiedCol<-"slategray"
VerrucomicrobiotaCol<-"purple"
WPS2Col<-"plum3"
#WS1Col<-"orange"
######
library
unique(dataset$Phylum)
head(dataset)
png("./Figures/AS_16splots/relativeabundanceallphyla.png",height=10,width=20,units="cm",res=300)
ggplot(dataset, aes(variable, y=relative_abundance,fill=Phylum)) + geom_bar(aes(fill=Phylum),stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CalditrichotaCol,ChloroflexiCol, CrenarchaeotaCol,
CyanobacteriaCol, DadabacteriaCol,DeferrisomatotaCol, DeinococcotaCol, DesulfobacterotaCol, EntotheonellaeotaCol,
GemmatimonadotaCol,LatescibacterotaCol, MyxococcotaCol, NB1jCol ,NitrospinotaCol, NitrospirotaCol,PlanctomycetotaCol,
ProteobacteriaCol, SAR324cladeCol, SpirochaetotaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
#Core OTUs
unique(coredataset$Phylum)
png("./Figures/AS_16splots/relativeabundance-corephyla.png",height=10,width=20,units="cm",res=300)
ggplot(coredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, DadabacteriaCol, DesulfobacterotaCol,NitrospirotaCol,PlanctomycetotaCol, ProteobacteriaCol,UnclassifiedCol, VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
ggplot(coredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, DadabacteriaCol, DesulfobacterotaCol,NitrospirotaCol,PlanctomycetotaCol, ProteobacteriaCol,UnclassifiedCol, VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
#####
##Grid panel for stacked bars
legend<-get_legend(ggplot(dataset, aes(variable, y=relative_abundance,fill=Phylum)) + geom_bar(aes(fill=Phylum),stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CalditrichotaCol,ChloroflexiCol, CrenarchaeotaCol,
CyanobacteriaCol, DadabacteriaCol,DeferrisomatotaCol, DeinococcotaCol, DesulfobacterotaCol, EntotheonellaeotaCol,
GemmatimonadotaCol,LatescibacterotaCol, MyxococcotaCol, NB1jCol ,NitrospinotaCol, NitrospirotaCol,PlanctomycetotaCol,
ProteobacteriaCol, SAR324cladeCol, SpirochaetotaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))+
guides(fill=guide_legend(ncol=1)))
plot1<-ggplot(dataset, aes(variable, y=relative_abundance,fill=Phylum)) + geom_bar(aes(fill=Phylum),stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CalditrichotaCol,ChloroflexiCol, CrenarchaeotaCol,
CyanobacteriaCol, DadabacteriaCol,DeferrisomatotaCol, DeinococcotaCol, DesulfobacterotaCol, EntotheonellaeotaCol,
GemmatimonadotaCol,LatescibacterotaCol, MyxococcotaCol, NB1jCol ,NitrospinotaCol, NitrospirotaCol,PlanctomycetotaCol,
ProteobacteriaCol, SAR324cladeCol, SpirochaetotaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+ggtitle("Including all OTUs")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9),legend.position="none")
plot2<-ggplot(coredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, DadabacteriaCol, DesulfobacterotaCol,NitrospirotaCol,PlanctomycetotaCol, ProteobacteriaCol,UnclassifiedCol, VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+ggtitle("Including only core OTUs")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9),legend.position="none")
png("Figures/AS_16splots/stackedbar16s.png",width=14,height=7,units="in",res=300)
plot_grid(plot1,plot2,legend,nrow=1,rel_widths=c(2/5,2/5,1/5))
dev.off()
#non core phyla
unique(noncoredataset$Phylum)
png("./Figures/AS_16splots/relativeabundance-non-corephyla.png",height=10,width=20,units="cm",res=300)
ggplot(noncoredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="fill") +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol,CalditrichotaCol,ChloroflexiCol, CrenarchaeotaCol,
CyanobacteriaCol, DadabacteriaCol,DeferrisomatotaCol, DeinococcotaCol, DesulfobacterotaCol, EntotheonellaeotaCol,
GemmatimonadotaCol,LatescibacterotaCol, MyxococcotaCol, NB1jCol ,NitrospinotaCol, NitrospirotaCol,PlanctomycetotaCol,
ProteobacteriaCol, SAR324cladeCol, SpirochaetotaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
#TO look at OTUs across sp and sample in the core OTUs
head(coredata)
coredataprop<-coredata
coredataprop[,2:45]<-apply(coredata[,2:45],2,function(x) x/sum(x))
mcore_otu<-melt(coredataprop)
levels(mcore_otu$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(mcore_otu$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tme","Tme","Tau")
unique(mcore_otu$Phylum)
nmcore_otu<-mcore_otu
nmcore_otu$Phylum<-factor(nmcore_otu$Phylum,levels=c(unique(nmcore_otu$Phylum)))
head(nmcore_otu)
png("./Figures/AS_16splots/relativeabundance-otus-betweensp.png",height=20,width=20,units="cm",res=300)
ggplot(nmcore_otu, aes(x=X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) +
scale_fill_manual(values = c(CrenarchaeotaCol,UnclassifiedCol, ActinobacteriotaCol, BacteroidotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, DesulfobacterotaCol, NitrospirotaCol,AcidobacteriotaCol,DadabacteriaCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="right",legend.direction="vertical")+
facet_wrap(~variable,nrow=3)
dev.off()
#FOr just one sp?
Tau_corePropsWithTaxonomyMelted<-subset(mcore_otu, variable=="Tau")
unique(Tau_corePropsWithTaxonomyMelted$Phylum)
ggplot(Tau_corePropsWithTaxonomyMelted, aes(X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) +
scale_fill_manual(values = c(AcidobacteriotaCol, ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, DadabacteriaCol, DesulfobacterotaCol,NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
#High abundance cc (above 0.1 relative abundance in any sample)
core_high<-mcore_otu%>%
arrange(desc(value))%>%
filter(value>0.1)
unique(core_high$Phylum)
ncore_high<-core_high
ncore_high$Phylum<-factor(ncore_high$Phylum,levels=c(unique(ncore_high$Phylum)))
png("./Figures/AS_16splots/highabundance-otusv1.png",height=20,width=20,units="cm",res=300)
ggplot(ncore_high, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(rows=vars(variable)) +
scale_fill_manual(values = c(CrenarchaeotaCol,UnclassifiedCol,PlanctomycetotaCol,CyanobacteriaCol,ActinobacteriotaCol, BacteroidotaCol, ProteobacteriaCol, NitrospirotaCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
png("./Figures/AS_16splots/highabundance-otusv2.png",height=10,width=30,units="cm",res=300)
ggplot(ncore_high, aes(variable, y=value)) + geom_boxplot(aes(fill=Phylum))+ geom_jitter(colour="gray80", alpha=0.65) +
facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(CrenarchaeotaCol,UnclassifiedCol,PlanctomycetotaCol,CyanobacteriaCol,ActinobacteriotaCol, BacteroidotaCol, ProteobacteriaCol, NitrospirotaCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
core_low<-mcore_otu%>%
arrange(desc(value))%>%
filter(value<=0.1)
unique(core_low$Phylum)
ncore_low<-core_low
ncore_low$Phylum<-factor(ncore_low$Phylum, levels=c(unique(ncore_low$Phylum)))
png("./Figures/AS_16splots/lowabundance-otusv1.png",height=20,width=30,units="cm",res=300)
ggplot(ncore_low, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) +
facet_grid(cols=vars(variable)) +  facet_wrap(~variable,nrow=3)+
scale_fill_manual(values = c(UnclassifiedCol,BacteroidotaCol,PlanctomycetotaCol,CyanobacteriaCol,
ProteobacteriaCol,DesulfobacterotaCol,ActinobacteriotaCol,CrenarchaeotaCol,
NitrospirotaCol,AcidobacteriotaCol,DadabacteriaCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="right",legend.direction="vertical")
dev.off()
png("./Figures/AS_16splots/lowabundance-otusv2.png",height=10,width=40,units="cm",res=300)
ggplot(ncore_low, aes(variable, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) +
scale_fill_manual(values = c(UnclassifiedCol,BacteroidotaCol,PlanctomycetotaCol,CyanobacteriaCol,
ProteobacteriaCol,DesulfobacterotaCol,ActinobacteriotaCol,CrenarchaeotaCol,
NitrospirotaCol,AcidobacteriotaCol,DadabacteriaCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
#core
unique(mcore_otu$Phylum)
png("./Figures/AS_16splots/coreotusbargraph.png",height=10,width=20,units="cm",res=300)
ggplot(nmcore_otu, aes(x=fct_reorder(as.factor(X.OTU.ID),value,.desc=TRUE), y=value)) + geom_bar(aes(fill=Phylum), stat="identity") +
scale_fill_manual(values = c(CrenarchaeotaCol,UnclassifiedCol, ActinobacteriotaCol, BacteroidotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, DesulfobacterotaCol, NitrospirotaCol,AcidobacteriotaCol,DadabacteriaCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
otucount<-dataset%>%
filter(value>0)
otucount<-otucount%>%
group_by(Phylum,variable)%>%
dplyr::summarize(Numb_otu=n())
relabunds<-dataset%>%
filter(value>0)
relabunds<-relabunds%>%
group_by(Phylum,variable)%>%
dplyr::summarise(abundance=sum(relative_abundance))
head(dataset)
sum(dataset$relative_abundance[dataset$variable=="Tau"])
dim(relabunds)
bubbledata<-cbind(otucount,relabunds[3])
head(bubbledata)
#SHowing between phylums
bubbledata[bubbledata==0]<-NA
#Showing between species
head(bubbledata)
png("./Figures/AS_16splots/bubble_phylum_richness_and_abundance.png",height=20,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.9,15))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+
theme(axis.text.x = element_text(face = "italic"),legend.margin = margin(0,0,0,-2))+
guides(color = guide_legend(override.aes = list(size = 5),ncol=2),size=guide_legend(nrow=1) )
dev.off()
#Only core OTUs
head(coredataset)
head(dataset)
coreotucount<-coredataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarize(Numb_otu=n())
dim(otucount)
corerelabunds<-coredataset%>%
filter(value>0)%>%
group_by(Phylum,variable)%>%
dplyr::summarise(abundance=sum(relative_abundance))
dim(relabunds)
corebubbledata<-cbind(coreotucount,corerelabunds[3])
#SHowing between phylums
corebubbledata[corebubbledata==0]<-NA
##plot
head(corebubbledata)
unique(corebubbledata$Phylum)
png("./Figures/AS_16splots/bubble_phylum_richness_and_abundanceCORE.png",height=20,width=30,units="cm",res=300)
ggplot(corebubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DesulfobacterotaCol,
NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.9,15))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+
theme(axis.text.x = element_text(face = "italic"),legend.margin = margin(0,0,0,-2))+
guides(color = guide_legend(override.aes = list(size = 5),ncol=2),size=guide_legend(nrow=1) )
dev.off()
library(cowplot)
library(gridExtra)
fullbubble<-ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.9,15))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+
theme(axis.text.x = element_text(face = "italic"),legend.margin = margin(0,0,0,-2))+
guides(color = guide_legend(override.aes = list(size = 5),ncol=2),size=guide_legend(nrow=1) )
legend<-get_legend(fullbubble)
fullbubble2<-ggplot(bubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+
labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.9,15))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+
scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+
theme(axis.text.x = element_text(face = "italic"),legend.position = ("none"))+
ggtitle("Including all OTUs")
corebubble2<-ggplot(corebubbledata,aes(x=variable,y=Numb_otu,color=Phylum,size=abundance))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DesulfobacterotaCol,
NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Phylum Richness",size="Relative abundance")+
scale_size(range = c(.9,15))+theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+ theme(axis.text.x = element_text(face = "italic"),legend.position = "none")+
ggtitle("Including only Core OTUs")
png("Figures/AS_16splots/bubbleplots16s.png",width=11,height=5,units="in",res=300)
grid.arrange(fullbubble2,corebubble2,legend,nrow=1)
dev.off()
??png()
#Visualize Otus seperately- compare abundance across phylas per sp
head(dataset)
dataset[dataset==0]<-NA
dataset<-dataset%>%
filter(relative_abundance>0)
###
png("./Figures/AS_16splots/bubble_otu_abundance.png",height=30,width=30,units="cm",res=300)
ggplot(dataset,aes(x=variable,y=relative_abundance,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+
theme(axis.text.x = element_text(face = "italic"),legend.margin = margin(0,0,0,-2))+
guides(color = guide_legend(override.aes = list(size = 5),ncol=2),size=guide_legend(nrow=1) )
dev.off()
#Abundance divided by richness
png("./Figures/AS_16splots/bubble_phyla_abundance_dividedby_richness.png",height=20,width=30,units="cm",res=300)
ggplot(bubbledata,aes(x=variable,y=abundance/Numb_otu,color=Phylum))+
scale_color_manual(values=c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol))+labs(x="Species",y="Relative abundance/Phylum richness")+
theme_bw()+geom_jitter(width=0.3,alpha=0.9)+scale_x_discrete(labels=c("Tethya aurantium","Tethia citrina","Tethya meloni"))+
theme(axis.text.x = element_text(face = "italic"),legend.margin = margin(0,0,0,-2))+
guides(color = guide_legend(override.aes = list(size = 5),ncol=2),size=guide_legend(nrow=1) )
dev.off()
