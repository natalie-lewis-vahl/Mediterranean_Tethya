count<-apply(as.data.frame(xmerged),1,sum)
??apply
merged<-cbind(merged,count)
head(merged)
#Remove OTUS with less than 50 reads
filtered<-merged[merged$count>=50,]
filtered[filtered==""]<-"Unclassified"
unique(filtered$Phylum)
??count
filtered$Phylum<-str_replace_all(filtered$Phylum,"SAR324 clade(Marine group B)","SAR324 clade")
filtered[filtered=="SAR324 clade(Marine group B)"]<-"SAR324 clade"
unique(filtered$Phylum)
plot1data<-filtered%>%
dplyr::count(Phylum)
data<-plot1data$n
names(data)<-plot1data$Phylum
barplot(data)
View(data)
#The large amount of otus belonging to unclassified makes other phyla harder
#to differentiate - could represent same phyla or lots of different ones
#remove 9215 unknown OTUs optional
#plot1data<-plot1data[!(plot1data$Phylum=="Unclassified"),]
data2<-plot1data$n
names(data2)<-plot1data$Phylum
barplot(data2)
#delete row with unclassified phyla
#filtered<-filtered[!(filtered$Phylum=="Unclassified"),]
counts<-table(filtered$Class,filtered$Phylum)
head(counts)
#using ggplot
#Arrange table for this and order to have nice plot
datax<-plot1data
datax<-datax %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
View(datax)
tiff("./Figures/AS_16splots/overall16s_taxa_distribution2.tiff",units="in", width=26, height=11, res=300)
ggplot(datax,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,175),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_x_discrete(expand=c(0,0))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
DesulfobacterotaCol,ActinobacteriotaCol,AcidobacteriotaCol,VerrucomicrobiotaCol,
MyxococcotaCol,NitrospirotaCol,CyanobacteriaCol,DeferrisomatotaCol,NB1jCol,
ChloroflexiCol,CrenarchaeotaCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,CalditrichotaCol,DeinococcotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+ggtitle("All 3 tethya species combined")+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=10),legend.position="none",plot.title=element_text(hjust=0.5))+
theme(text=element_text(size=14),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ) )
dev.off()
tiff("./Figures/AS_16splots/overall16s_taxa_distribution2.tiff",units="in", width=27, height=11, res=300)
ggplot(datax,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,175),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_x_discrete(expand=c(0,0))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
DesulfobacterotaCol,ActinobacteriotaCol,AcidobacteriotaCol,VerrucomicrobiotaCol,
MyxococcotaCol,NitrospirotaCol,CyanobacteriaCol,DeferrisomatotaCol,NB1jCol,
ChloroflexiCol,CrenarchaeotaCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,CalditrichotaCol,DeinococcotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+ggtitle("All 3 tethya species combined")+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=10),legend.position="none",plot.title=element_text(hjust=0.5))+
theme(text=element_text(size=14),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ) )
dev.off()
tiff("./Figures/AS_16splots/overall16s_taxa_distribution2.tiff",units="in", width=28, height=11, res=300)
ggplot(datax,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,175),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_x_discrete(expand=c(0,0))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
DesulfobacterotaCol,ActinobacteriotaCol,AcidobacteriotaCol,VerrucomicrobiotaCol,
MyxococcotaCol,NitrospirotaCol,CyanobacteriaCol,DeferrisomatotaCol,NB1jCol,
ChloroflexiCol,CrenarchaeotaCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,CalditrichotaCol,DeinococcotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+ggtitle("All 3 tethya species combined")+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=10),legend.position="none",plot.title=element_text(hjust=0.5))+
theme(text=element_text(size=14),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ) )
dev.off()
library(dplyr)
library(ggplot2)
taxa<-read.table("./Data/16s_allsamples_taxa.csv",header=TRUE,sep=";")
otus<-read.table("./Data/16s_allsamples_otu.csv",sep=";")
names(taxa)
names(otus)
reorder_id<-match(taxa$sequence_identifier,otus$V1)
otus<-otus[reorder_id,]
merged<-merge(taxa,otus,by.x="sequence_identifier",by.y="V1")
str(merged)
dim(merged)
xmerged<-(merged[-c(1:8)])
xmerged<-lapply(xmerged,as.numeric)
head(xmerged)
count<-apply(as.data.frame(xmerged),1,sum)
??apply
merged<-cbind(merged,count)
head(merged)
#Remove OTUS with less than 50 reads
filtered<-merged[merged$count>=50,]
filtered[filtered==""]<-"Unclassified"
unique(filtered$Phylum)
??count
filtered$Phylum<-str_replace_all(filtered$Phylum,"SAR324 clade(Marine group B)","SAR324 clade")
filtered[filtered=="SAR324 clade(Marine group B)"]<-"SAR324 clade"
unique(filtered$Phylum)
plot1data<-filtered%>%
dplyr::count(Phylum)
data<-plot1data$n
names(data)<-plot1data$Phylum
barplot(data)
View(data)
#The large amount of otus belonging to unclassified makes other phyla harder
#to differentiate - could represent same phyla or lots of different ones
#remove 9215 unknown OTUs optional
#plot1data<-plot1data[!(plot1data$Phylum=="Unclassified"),]
data2<-plot1data$n
names(data2)<-plot1data$Phylum
barplot(data2)
#delete row with unclassified phyla
#filtered<-filtered[!(filtered$Phylum=="Unclassified"),]
counts<-table(filtered$Class,filtered$Phylum)
head(counts)
jpeg("./Figures/AS_16splots/overall16s_taxa_distribution.jpeg",units="in", width=35, height=10, res=300)
barplot(counts,xlab="Phyla",ylab="Number of OTUs",cex.names= 0.5,ylim=c(0,160))
dev.off()
??barplot
#using ggplot
#Arrange table for this and order to have nice plot
datax<-plot1data
datax<-datax %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
View(datax)
#colours
################
AcidobacteriotaCol<-"yellowgreen"
ActinobacteriotaCol<-"yellow2"
BacteroidotaCol<-"wheat3"
BdellovibrionotaCol<-"darkslategray"
CalditrichotaCol<-"tomato3"
CampylobacterotaCol<-"wheat1"
ChloroflexiCol<-"violetred2"
CrenarchaeotaCol<-"violetred"
CyanobacteriaCol<-"violet"
DadabacteriaCol<-"turquoise4"
DeferrisomatotaCol<-"turquoise3"
DeinococcotaCol<-"turquoise"
#DependentiaeCol<-"tomato3"
DesulfobacterotaCol<-"tomato1"
EntotheonellaeotaCol<-"Violetred4"
#FirmicutesCol<-"black"
#FusobacteriotaCol<-"rosybrown3"
GemmatimonadotaCol<-"tan3"
#HydrogenedentesCol<-"tan1"
LatescibacterotaCol<-"steelblue4"
MyxococcotaCol<-"steelblue2"
NB1jCol<-"springgreen4"
NitrospinotaCol<-"springgreen2"
NitrospirotaCol<-"slategray2"
PAUC34fCol<-"darkkhaki"
PlanctomycetotaCol<-"purple4"
ProteobacteriaCol<-"salmon"
SAR324cladeCol<-"royalblue"
SpirochaetotaCol<-"tan4"
#SumerlaeotaCol<-"red2"
UnclassifiedCol<-"slategray"
VerrucomicrobiotaCol<-"purple"
WPS2Col<-"plum3"
tiff("./Figures/AS_16splots/overall16s_taxa_distribution2.tiff",units="in", width=28, height=11, res=300)
ggplot(datax,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,175),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_x_discrete(expand=c(0,0))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
DesulfobacterotaCol,ActinobacteriotaCol,AcidobacteriotaCol,VerrucomicrobiotaCol,
MyxococcotaCol,NitrospirotaCol,CyanobacteriaCol,DeferrisomatotaCol,NB1jCol,
ChloroflexiCol,CrenarchaeotaCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,CalditrichotaCol,DeinococcotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+ggtitle("All 3 tethya species combined")+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=10),legend.position="none",plot.title=element_text(hjust=0.5))+
theme(text=element_text(size=14),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ) )
dev.off()
#species seperately
#Tau V2 till v12+v45 (col 9-19,52)
dim(filtered)
filteredtau<-filtered[,-c(20:51)]
dim(filteredtau)
taux<-filteredtau[!apply(filteredtau[,9:20]==0,1,all),]
dim(taux)
#Tme v13 till v23 +v43tillv44 (col 20-30,50,51)
filteredtme<-filtered[,-c(9:19,31:49,52)]
head(filteredtme)
tmex<-filteredtme[!apply(filteredtme[,9:21]==0,1,all),]
#Tci v35 till v42 (col 42-49)
filteredtci<-filtered[-c(9:30,50:52)]
tcix<-filteredtci[!apply(filteredtci[,9:27]==0,1,all),]
#scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
plot2data<-taux%>%
dplyr::count(Phylum)
datatau<-plot2data %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
##########
tiff("./Figures/AS_16splots/tau16s_taxa_distribution2.tiff",units="in", width=9, height=7, res=300)
ggplot(datatau,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,150),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_x_discrete(expand=c(0,0))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
ActinobacteriotaCol,DesulfobacterotaCol,VerrucomicrobiotaCol,AcidobacteriotaCol,
NitrospirotaCol,CyanobacteriaCol,MyxococcotaCol,NB1jCol,
CrenarchaeotaCol,ChloroflexiCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,DeferrisomatotaCol,DeinococcotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+
ggtitle(expression(italic("Tethya aurantium")))+
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=0.8,size=9),legend.position="none")+
theme(text=element_text(size=10),axis.title.x=element_text(vjust=3),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ))
dev.off()
####Tme
plot3data<-tmex%>%
dplyr::count(Phylum)
datatme<-plot3data %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
##########
tiff("./Figures/AS_16splots/tme16s_taxa_distribution2.tiff",units="in", width=9, height=7, res=300)
ggplot(datatme,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,150),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
ActinobacteriotaCol,VerrucomicrobiotaCol,AcidobacteriotaCol,DesulfobacterotaCol,
NitrospirotaCol,CyanobacteriaCol,MyxococcotaCol,CrenarchaeotaCol,NB1jCol,
DadabacteriaCol,EntotheonellaeotaCol,GemmatimonadotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+
ggtitle(expression(italic("Tethya meloni")))+
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=0.8,size=9),legend.position="none")+
theme(text=element_text(size=10),axis.title.x=element_text(vjust=3),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ))
dev.off()
####Tci
plot4data<-tcix%>%
dplyr::count(Phylum)
datatci<-plot4data %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
##########
tiff("./Figures/AS_16splots/tci16s_taxa_distribution2.tiff",units="in", width=9, height=7, res=300)
ggplot(datatci,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,150),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
DesulfobacterotaCol,ActinobacteriotaCol,AcidobacteriotaCol,VerrucomicrobiotaCol,
MyxococcotaCol,NitrospirotaCol,CyanobacteriaCol,DeferrisomatotaCol,NB1jCol,
ChloroflexiCol,CrenarchaeotaCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,CalditrichotaCol,DeinococcotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol)) +
labs(x="Phylum",y="Number of OTUs")+
ggtitle(expression(italic("Tethya citrina")))+
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=0.8,size=9),legend.position="none")+
theme(text=element_text(size=10),axis.title.x=element_text(vjust=3),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ))
dev.off()
##########
tiff("./Figures/AS_16splots/tau16s_taxa_distribution2.tiff",units="in", width=10, height=8, res=300)
ggplot(datatau,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,150),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_x_discrete(expand=c(0,0))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
ActinobacteriotaCol,DesulfobacterotaCol,VerrucomicrobiotaCol,AcidobacteriotaCol,
NitrospirotaCol,CyanobacteriaCol,MyxococcotaCol,NB1jCol,
CrenarchaeotaCol,ChloroflexiCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,DeferrisomatotaCol,DeinococcotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+
ggtitle(expression(italic("Tethya aurantium")))+
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=0.8,size=9),legend.position="none")+
theme(text=element_text(size=10),axis.title.x=element_text(vjust=3),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ))
dev.off()
####Tme
plot3data<-tmex%>%
dplyr::count(Phylum)
datatme<-plot3data %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
##########
tiff("./Figures/AS_16splots/tme16s_taxa_distribution2.tiff",units="in", width=10, height=8, res=300)
ggplot(datatme,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,150),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
ActinobacteriotaCol,VerrucomicrobiotaCol,AcidobacteriotaCol,DesulfobacterotaCol,
NitrospirotaCol,CyanobacteriaCol,MyxococcotaCol,CrenarchaeotaCol,NB1jCol,
DadabacteriaCol,EntotheonellaeotaCol,GemmatimonadotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol,SpirochaetotaCol)) +
labs(x="Phylum",y="Number of OTUs")+
ggtitle(expression(italic("Tethya meloni")))+
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=0.8,size=9),legend.position="none")+
theme(text=element_text(size=10),axis.title.x=element_text(vjust=3),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ))
dev.off()
####Tci
plot4data<-tcix%>%
dplyr::count(Phylum)
datatci<-plot4data %>%
arrange(desc(n)) %>%
mutate(Phylum=factor(Phylum, levels=Phylum))
##########
tiff("./Figures/AS_16splots/tci16s_taxa_distribution2.tiff",units="in", width=10, height=8, res=300)
ggplot(datatci,aes(x=Phylum,y=n,fill=Phylum))+
geom_bar(stat="identity")+scale_y_continuous(limits=c(0,150),expand=c(0,0),minor_breaks = seq(0 , 175, 5), breaks = seq(0, 175, 50))+
scale_fill_manual(values = c(ProteobacteriaCol,UnclassifiedCol,PlanctomycetotaCol,BacteroidotaCol,
DesulfobacterotaCol,ActinobacteriotaCol,AcidobacteriotaCol,VerrucomicrobiotaCol,
MyxococcotaCol,NitrospirotaCol,CyanobacteriaCol,DeferrisomatotaCol,NB1jCol,
ChloroflexiCol,CrenarchaeotaCol,DadabacteriaCol,EntotheonellaeotaCol,
GemmatimonadotaCol,CalditrichotaCol,DeinococcotaCol,LatescibacterotaCol,
NitrospinotaCol,SAR324cladeCol)) +
labs(x="Phylum",y="Number of OTUs")+
ggtitle(expression(italic("Tethya citrina")))+
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=0.8,size=9),legend.position="none")+
theme(text=element_text(size=10),axis.title.x=element_text(vjust=3),panel.grid.major.x = element_blank(),panel.grid.major.y = element_line( size=.1, color="grey30" ))
dev.off()
#Alpha, beta and gamma
library(matrixStats)
library(dplyr)
library(vegan)
library(ggplot2)
library(cowplot)
taotus<-read.csv("./Data/16and18s_otu.csv", sep=";")
otus<-arrange(taotus, X.OTU.ID)
#BInd taxonomy to remove bacterial OTUs from 18s dataset
taxa<-read.csv("./Data/16ans18s_taxa.csv",sep=";")
head(otus)
taxa<-arrange(taxa,sequence_identifier)
otu_and_taxa<-bind_cols(otus,taxa)
otu_and_taxa<-otu_and_taxa%>%filter(!(Domain=="Bacteria" & dataset=="18s"))
#and remove two otus fromcoamplified sponges for 18s
#Take out OTU 1 for sponge amplification
head(otu_and_taxa)
otu_and_taxa<-otu_and_taxa[-c(47)]
countSum<-apply(otu_and_taxa[3:46],1,sum)
otus_and_taxa<-cbind(otu_and_taxa,countSum)
coamplif_sponge<-otus_and_taxa[otus_and_taxa$dataset=="18s",]%>%
arrange(desc(countSum))
#
coamplif_sponge$sequence_identifier[1]#OTU_4076
otus_and_taxa<-otus_and_taxa[!(otus_and_taxa$X.OTU.ID=="OTU_4076"),]
coamplif_sponge$sequence_identifier[2]#OTU_4077
otus_and_taxa<-otus_and_taxa[!(otus_and_taxa$X.OTU.ID=="OTU_4077"),]
#filtering: should be done seperate for both 16 and 18s data set
#Keep rows that have more than 50 counds and are from 16s data set OR have more than 5 counts and belong to 18s ddataset
otus_and_taxab<-otus_and_taxa[otus_and_taxa$countSum >= 50 & otus_and_taxa$dataset=="16s"|otus_and_taxa$countSum >= 5 & otus_and_taxa$dataset=="18s",]
head(otus_and_taxab)
data_all<-otus_and_taxab
View(data_all)
library(writexl)
install.packages("writexl")
library(writexl)
writexl("Figures/data_all.xsl")
write_xlsx("Figures/data_all.xsl")
write_xlsx(data_all,"Figures/data_full_filtered.xsl")
write_xlsx(data_all,"Figures/data_full_filtered.xlsx")
library(vegan)
library(matrixStats)
library(dplyr)
matrix_file<-"./Data/16s_allsamples_otu.csv"
bact_matrix<-read.csv(matrix_file, head=T, sep=";", row.names=1)
countSum<-apply(bact_matrix,1,sum)#sum the rows
pct<-countSum/sum(countSum)
bact_matrix<-cbind(bact_matrix, countSum, pct)
bact_matrix<-bact_matrix%>%
arrange(desc(pct))
bact_matrix<-bact_matrix%>%
mutate(cumpct=cumsum(pct))
dim(bact_matrix)
#if filtering is wanted up to 95% cumulative sum of abundance can
#use cumpct column
#bact_matrix<-bact_matrix[bact_matrix$cumpct < 95,]
head(bact_matrix)
bact_matrix<-bact_matrix[bact_matrix$countSum >=50,]
dim(bact_matrix)
#groups
#Tau:"GW1941" "GW1942" "GW1943" "GW1944" "GW1945" "GW1946" "GW1947" "GW1948" "GW1949" "GW1950" "GW1951" "GW1984"
#Tme:"GW1952" "GW1953" "GW1954" "GW1955" "GW1956" "GW1957" "GW1958" "GW1959" "GW1960" "GW1961" "GW1962" "GW1982" "GW1983"
#Tci:"GW1963" "GW1964" "GW1965" "GW1966" "GW1967" "GW1968" "GW1969" "GW1970" "GW1971" "GW1972" "GW1973""GW1974" "GW1975" "GW1976" "GW1977" "GW1978" "GW1979""GW1980" "GW1981"
#group vectors for non bactloadCorrected datasets
num_groups<-c(1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1)
label_groups<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tme","Tme","Tau")
#head(bact_matrix)
#creeate plot and delete columns with cumpct, pct and cumsum
nmds<-metaMDS(t(bact_matrix[,-c(45:47)]), try=50)
head(bact_matrix)
is.matrix(bact_matrix)
xbact_matrix<-as.matrix(bact_matrix[,-c(45:47)])
bact_matrix_rMeans<-rowMeans(xbact_matrix)
bact_matrix_rSds<-rowSds(xbact_matrix)
bact_matrix_zscores<-((xbact_matrix-bact_matrix_rMeans)/bact_matrix_rSds)
png("./Figures/AS_16splots/heatmap_variability_16s_allotus.png",height=14,width=8,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotus.png",height=14,width=14,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotus.png",height=18,width=14,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotus.png",height=24,width=14,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotus.png",height=24,width=24,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotusfull.png",height=28,width=28,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotusfull.png",height=8,width=8,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
png("./Figures/AS_16splots/heatmap_variability_16s_allotus.png",height=8,width=8,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
#Display large plot with all OTUs visible-to be able to zoom
png("./Figures/AS_16splots/heatmap_variability_16s_allotusfull.png",height=28,width=28,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),cexRow=8,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
#Display large plot with all OTUs visible-to be able to zoom
png("./Figures/AS_16splots/heatmap_variability_16s_allotusfull.png",height=28,width=28,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),cexRow=1,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
#Display large plot with all OTUs visible-to be able to zoom
png("./Figures/AS_16splots/heatmap_variability_16s_allotusfull.png",height=28,width=28,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),cexRow=0.5,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
??heatmap
heatmap(as.matrix(bact_matrix_zscores),par(mfrow=2),cexRow=0.5,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
heatmap(as.matrix(bact_matrix_zscores),par(mfrow=2,1),cexRow=0.5,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
heatmap(as.matrix(bact_matrix_zscores),par(mfrow=c(2,1)),cexRow=0.5,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
#Display large plot with all OTUs visible-to be able to zoom
png("./Figures/AS_16splots/heatmap_variability_16s_allotusfull.png",height=30,width=30,units="in",res=300)
heatmap(as.matrix(bact_matrix_zscores),cexRow=0.5,ColSideColors =c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
library(vegan)
library(matrixStats)
library(dplyr)
matrix_file<-"./Data/18s/all.otutab.csv"
otus<-read.csv("./Data/18s/all.otutab.csv", sep=";")
#BInd taxonomy to remove bacteria
taxa<-read.csv("./Data/18s/taxa_fixed18s.csv",sep=";")
otus<-arrange(otus, X.OTU.ID)
taxa<-arrange(taxa,sequence_identifier)
otu_and_taxa<-bind_cols(otus,taxa)
otu_and_taxa<-otu_and_taxa%>%filter(Domain!="Bacteria")
#Take out OTU 1 for sponge amplification
otus_and_taxa<-otu_and_taxa[!(otu_and_taxa$X.OTU.ID=="OTU_4076"),]
#Uncomment to also take out OTU 2
otus_and_taxa<-otu_and_taxa[!(otu_and_taxa$X.OTU.ID=="OTU_4077"),]
head(otus_and_taxa)
#Uncomment bellow to Remove all otus for demospongiae
#otu_and_taxa<-otu_and_taxa%>%filter(Phylum!="Porifera")
#Remove OTUS with less than 5 reads
countSum<-apply(otus_and_taxa[2:45],1,sum)
otus_and_taxa<-cbind(otus_and_taxa,countSum)
#same thing as using size column from taxa dataset
otus_and_taxa<-otus_and_taxa[otus_and_taxa$countSum>=5,]
d18s_matrix<-otus_and_taxa[,-c(46:57)]
#rEMOVE SEQUENCE id AS A COLUMN AND MAKE THEM THE ROW NAMES
row.names(d18s_matrix)<-d18s_matrix$X.OTU.ID
#remove column with id names and taxa columns again
d18s_matrix<-d18s_matrix[,-1]
#if filtering is wanted at a more thorough level of 95%
#countSum<-apply(d18s_matrix,1,sum)#sum the rows
#pct<-countSum/sum(countSum)
#d18s_matrix<-cbind(d18s_matrix, countSum, pct)
#d18s_matrix[desc(d18s_matrix$pct),]
#d18s_matrix<-d18s_matrix%>%
#  mutate(cumpct=cumsum(pct))
#d18s_matrix<-d18s_matrix%>%
#  arrange(desc(pct))
#d18s_matrix<-d18s_matrix[d18s_matrix$cumpct < 0.95,]
#358 rows with only OTU1 removed and 499 rows with OTU2 also removed
#groups
#T aurantium: GW1941 till GW1951 inclusive + GW1984 (12 SAMPLES)
#T meloni: GW1952 till GW1962 +GW1982 +GW1983 (13 SAMPLES)
# T citroni: GW1963 till GW1981 inclusive (19 SAMPLES)
#group vectors for non bactloadCorrected datasets
num_groups<-c(1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1)
label_groups<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tme","Tme","Tau")
#Full large image to see all oTUs
png("Figures/18splots/heatmap_all_18sfull.png",units="in",height=16,width=16,res=300)
heatmap(as.matrix(matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
is.matrix(d18s_matrix)
xd18s_matrix<-as.matrix(d18s_matrix)
head(xd18s_matrix)
matrix_rMeans<-rowMeans(xd18s_matrix[,-c(45,46,47)])
matrix_rSds<-rowSds(xd18s_matrix[,-c(45,46,47)])
matrix_zscores<-((xd18s_matrix[,-c(45,46,47)]-matrix_rMeans)/matrix_rSds)
OTUVars<-sort(rowVars(xd18s_matrix[,-c(45,46,47)],useNames = T),decreasing = T)
#Full large image to see all oTUs
png("Figures/18splots/heatmap_all_18sfull.png",units="in",height=16,width=16,res=300)
heatmap(as.matrix(matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
heatmap(as.matrix(matrix_zscores),cexRow=0.5,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
#Full large image to see all oTUs
png("Figures/18splots/heatmap_all_18sfull.png",units="in",height=16,width=16,res=300)
heatmap(as.matrix(matrix_zscores),cexRow=0.5,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
#Full large image to see all oTUs
png("Figures/18splots/heatmap_all_18sfull.png",units="in",height=18,width=18,res=300)
heatmap(as.matrix(matrix_zscores),cexRow=0.5,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
#Full large image to see all oTUs
png("Figures/18splots/heatmap_all_18sfull.png",units="in",height=20,width=20,res=300)
heatmap(as.matrix(matrix_zscores),cexRow=0.5,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
#Full large image to see all oTUs
png("Figures/18splots/heatmap_all_18sfull.png",units="in",height=25,width=25,res=300)
heatmap(as.matrix(matrix_zscores),cexRow=0.5,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","darkblue","red","red","green"))
dev.off()
