summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
noncoredataset<-cbind(noncoredatamelt,xnoncoredatamelt[2])
unique(dataset$Phylum)
################
AcidobacteriotaCol<-"yellowgreen"
ActinobacteriotaCol<-"yellow2"
BacteroidotaCol<-"wheat3"
#BdellovibrionotaCol<-"navyblue"
CalditrichotaCol<-"tomato3"
#CampylobacterotaCol<-"ivory1"
ChloroflexiCol<-"violetred2"
ggplot(dataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum),stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
View(datamelt)
levels(datamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(datamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
#Group by species and calc relative abundance of each OTU for each species
xdatamelt<-datamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
dim(xdatamelt)
head(xdatamelt)
View(xdatamelt)
#Melt data set and remove unnecassary rows
datamelt<-melt(xdata[-c(1,46,47,49:53)])
levels(datamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(datamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
View(datamelt)
#Group by species and calc relative abundance of each OTU for each species
xdatamelt<-datamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
dim(xdatamelt)
head(xdatamelt)
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
dataset<-cbind(datamelt,xdatamelt[2])
ggplot(dataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum),stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
#WPS2Col<-"plum3"
#WS1Col<-"orange"
######
tiff("./Figures/AS_16splots/relativeabundanceallphyla.tiff",height=10,width=20,units="cm",res=300)
ggplot(dataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum),stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
#DAta with just the core OTUs and also with just non core OTUs
##core
coredata<-xdata[xdata$X.OTU.ID %in% core_community$X.OTU.ID,]
head(coredata)
coredatamelt<-melt(coredata[-c(1,46,47,49:53)])
levels(coredatamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(coredatamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
##for core dataset
#Group by species and calc relative abundance of each OTU for each species
xcoredatamelt<-coredatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
coredataset<-cbind(coredatamelt,xcoredatamelt[2])
##non-core
noncoredata<-xdata[!(xdata$X.OTU.ID %in% core_community$X.OTU.ID),]#HEREEE
noncoredatamelt<-melt(noncoredata[-c(1,46,47,49:53)])
#
levels(noncoredatamelt$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(noncoredatamelt$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
##REpeat for noncore dataset
#Group by species and calc relative abundance of each OTU for each species
xnoncoredatamelt<-noncoredatamelt%>%
group_by(variable)%>%
summarise(relative_abundance=value/sum(value))
#Bind the "relative_abundance" col (for each sp seperately) to the main data set
noncoredataset<-cbind(noncoredatamelt,xnoncoredatamelt[2])
unique(dataset$Phylum)
ggplot(coredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol,UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
tiff("./Figures/AS_16splots/relativeabundance-corephyla.tiff",height=10,width=20,units="cm",res=300)
ggplot(coredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol,UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
#non core phyla
tiff("./Figures/AS_16splots/relativeabundance-non-corephyla.tiff",height=10,width=20,units="cm",res=300)
ggplot(noncoredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,BdellovibrionotaCol,
CalditrichotaCol,CampylobacterotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DependentiaeCol,DesulfobacterotaCol,
EntotheonellaeotaCol,FirmicutesCol,FusobacteriotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,PAUC34fCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,SumerlaeotaCol,
UnclassifiedCol,VerrucomicrobiotaCol,WPS2Col,WS1Col)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
#non core phyla
unique(noncoredataset$Phylum)
tiff("./Figures/AS_16splots/relativeabundance-non-corephyla.tiff",height=10,width=20,units="cm",res=300)
ggplot(noncoredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
ggplot(noncoredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,HydrogenedentesCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
ggplot(noncoredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
tiff("./Figures/AS_16splots/relativeabundance-non-corephyla.tiff",height=10,width=20,units="cm",res=300)
ggplot(noncoredataset, aes(variable, y=relative_abundance)) + geom_bar(aes(fill=Phylum), stat="identity", position="stack") +
scale_fill_manual(values = c(AcidobacteriotaCol,ActinobacteriotaCol,BacteroidotaCol,
CalditrichotaCol,ChloroflexiCol,CrenarchaeotaCol,CyanobacteriaCol,
DadabacteriaCol,DeferrisomatotaCol,DeinococcotaCol,DesulfobacterotaCol,
EntotheonellaeotaCol,GemmatimonadotaCol,
LatescibacterotaCol,MyxococcotaCol,NB1jCol,NitrospinotaCol,NitrospirotaCol,
PlanctomycetotaCol,ProteobacteriaCol,SAR324cladeCol,SpirochaetotaCol,
UnclassifiedCol,VerrucomicrobiotaCol)) +
labs(x="Species",y="Relative abundance")+
scale_x_discrete(labels = expression(italic(T.aurantium),italic(T.meloni),italic(T.citrina)))+
theme_bw() + theme(axis.text.x=element_text(angle=0,hjust=0.5,size=9))
dev.off()
#TO look at OTUs across sp and sample in the core OTUs
coredataprop<-coredata
coredataprop[,2:45]<-apply(coredata[,2:45],2,function(x) x/sum(x))
mcore_otu<-melt(coredataprop)
levels(mcore_otu$variable)<-c("GW1941","GW1942" ,"GW1944", "GW1945", "GW1946", "GW1947", "GW1948",
"GW1952", "GW1953", "GW1954", "GW1955", "GW1957", "GW1958", "GW1959",
"GW1964", "GW1967", "GW1968", "GW1969", "GW1973", "GW1979", "GW1982")
levels(mcore_otu$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci")
levels(mocore_otu$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(mcore_otu$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
mcore_otu<-melt(coredataprop)
levels(mcore_otu$variable)<-c("GW1941","GW1942" ,"GW1943","GW1944", "GW1945", "GW1946", "GW1947", "GW1948","GW1949","GW1950","GW1951",
"GW1952","GW1953", "GW1954", "GW1955", "GW1956", "GW1957", "GW1958", "GW1959","GW1960","GW1961","GW1962",
"GW1963","GW1964","GW1965", "GW1966", "GW1967", "GW1968", "GW1969","GW1970","GW1971","GW1972", "GW1973","GW1974", "GW1975", "GW1976", "GW1977", "GW1978", "GW1979","GW1980","GW1981", "GW1982","GW1983", "GW1984")
levels(mcore_otu$variable)<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau",
"Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme",
"Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
head(mcore_otu)
#FOr all species
ggplot(mcore_otu, aes(x=X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) +
scale_fill_manual(values = c(ActinobacteriaCol, BacteroidetesCol, CrenarchaeotaCol, CyanobacteriaCol, DesulfobacterotaCol, NitrospirotaCol, PlanctomycetesCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
head(mcore_otu)
unique(mcore_otu$Phylum)
#FOr all species
ggplot(mcore_otu, aes(x=X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
#FOr all species
tiff("./Figures/AS_16splots/relativeabundance-otus-betweensp.tiff",height=10,width=20,units="cm",res=300)
ggplot(mcore_otu, aes(x=X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
dev.off()
#FOr all species
tiff("./Figures/AS_16splots/relativeabundance-otus-betweensp.tiff",height=10,width=30,units="cm",res=300)
ggplot(mcore_otu, aes(x=X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
dev.off()
#FOr just one sp?
Tau_corePropsWithTaxonomyMelted<-subset(mcore_otu, variable=="Tau")
unique(Tau_corePropsWithTaxonomyMelted$Phylum)
ggplot(Tau_corePropsWithTaxonomyMelted, aes(X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) +
scale_fill_manual(values = c(ActinobacteriaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
ggplot(Tau_corePropsWithTaxonomyMelted, aes(X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
ggplot(Tau_corePropsWithTaxonomyMelted, aes(X.OTU.ID, y=value)) + geom_boxplot(aes(fill=Phylum)) +
geom_jitter(colour="gray80", alpha=0.65) +
scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) +
theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="top",legend.direction="horizontal")
#High abundance cc (above 0.1 relative abundance in any sample)
core_high<-mcore_otu%>%
arrange(desc(value))%>%
filter(value>0.1)
head(core_high)
length(core_high)
ggplot(core_high, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriaCol, BacteroidetesCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetesCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
unique(core_high$Phylum)
ggplot(core_high, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
ggplot(core_high, aes(variable, y=value)) + geom_boxplot(aes(fill=Phylum))+ geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
tiff("./Figures/AS_16splots/highabundance-otusv1")
ggplot(core_high, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
tiff("./Figures/AS_16splots/highabundance-otusv2")
ggplot(core_high, aes(variable, y=value)) + geom_boxplot(aes(fill=Phylum))+ geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
core_low<-mcore_otu%>%
arrange(desc(value))%>%
filter(value<=0.1)
unique(core_low$Phylum)
ggplot(core_low, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
ggplot(core_low, aes(variable, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
tiff("./Figures/AS_16splots/lowabundance-otusv1")
ggplot(core_low, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
tiff("./Figures/AS_16splots/lowabundance-otusv2")
ggplot(core_low, aes(variable, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
tiff("./Figures/AS_16splots/highabundance-otusv1.tiff")
ggplot(core_high, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
tiff("./Figures/AS_16splots/highabundance-otusv2.tiff")
ggplot(core_high, aes(variable, y=value)) + geom_boxplot(aes(fill=Phylum))+ geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
tiff("./Figures/AS_16splots/lowabundance-otusv1.tiff")
ggplot(core_low, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
tiff("./Figures/AS_16splots/lowabundance-otusv2.tiff")
ggplot(core_low, aes(variable, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
#core
ggplot(mcore_otu, aes(X.OTU.ID, y=value)) + geom_bar(aes(fill=Phylum), stat="identity") + scale_fill_manual(values = c(ActinobacteriaCol, BacteroidetesCol, CrenarchaeotaCol, CyanobacteriaCol, DesulfobacterotaCol, NitrospirotaCol, PlanctomycetesCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
#core
ggplot(mcore_otu, aes(X.OTU.ID, y=value)) + geom_bar(aes(fill=Phylum), stat="identity") + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, DesulfobacterotaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1))
tiff("./Figures/coreotusbargraph.tiff")
tiff("./Figures/AS_16splots/highabundance-otusv1.tiff",height=10,width=30,units="cm",res=300)
ggplot(core_high, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
tiff("./Figures/AS_16splots/highabundance-otusv2.tiff",height=10,width=30,units="cm",res=300)
ggplot(core_high, aes(variable, y=value)) + geom_boxplot(aes(fill=Phylum))+ geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol,PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol)) + theme_bw() + theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
tiff("./Figures/AS_16splots/lowabundance-otusv1.tiff",height=10,width=30,units="cm",res=300)
ggplot(core_low, aes(X.OTU.ID, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(variable)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
tiff("./Figures/AS_16splots/lowabundance-otusv2.tiff",height=10,width=30,units="cm",res=300)
ggplot(core_low, aes(variable, y=value)) +
geom_boxplot(aes(fill=Phylum)) + geom_jitter(colour="gray80", alpha=0.65) + facet_grid(cols=vars(X.OTU.ID)) + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol,CrenarchaeotaCol, CyanobacteriaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1),legend.position="bottom",legend.direction="horizontal")
dev.off()
tiff("./Figures/coreotusbargraph.tiff",height=10,width=20,units="cm",res=300)
ggplot(mcore_otu, aes(X.OTU.ID, y=value)) + geom_bar(aes(fill=Phylum), stat="identity") + scale_fill_manual(values = c(ActinobacteriotaCol, BacteroidotaCol, CrenarchaeotaCol, CyanobacteriaCol, DesulfobacterotaCol, NitrospirotaCol, PlanctomycetotaCol, ProteobacteriaCol, UnclassifiedCol,VerrucomicrobiotaCol)) + theme_bw() +
theme(axis.text.x=element_text(angle=90,hjust=1))
dev.off()
library(vegan)
library(matrixStats)
library(dplyr)
matrix_file<-"./Data/16_allsamples_otu.csv"
bact_matrix<-read.csv(matrix_file, head=T, sep="\t", row.names=1)
matrix_file<-"./Data/16s_allsamples_otu.csv"
bact_matrix<-read.csv(matrix_file, head=T, sep="\t", row.names=1)
countSum<-apply(bact_matrix,1,sum)#sum the rows
pct<-countSum/sum(countSum)
bact_matrix<-cbind(bact_matrix, countSum, pct)
bact_matrix<-bact_matrix%>%
arrange(desc(pct))
bact_matrix<-bact_matrix%>%
mutate(cumpct=cumsum(pct))
dim(bact_matrix)
View(bact_matrix)
bact_matrix<-bact_matrix[bact_matrix$countSum >=50,]
#group vectors for non bactloadCorrected datasets
num_groups<-c(1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3)
label_groups<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
View(bact_matrix)
#head(bact_matrix)
#creeate plot and delete columns with cumpct, pct and cumsum
nmds<-metaMDS(t(bact_matrix[,-c(45:47)]), try=50)
plot(nmds, type = "t", display="sites")
points(nmds, col=num_groups, cex=1.5, pch=16)
ordispider(nmds, label_groups, label=T)
anosim(t(bact_matrix), num_groups)
bact_matrix<-read.csv(matrix_file, head=T, sep="\t", row.names=1)
countSum<-apply(bact_matrix,1,sum)#sum the rows
pct<-countSum/sum(countSum)
bact_matrix<-cbind(bact_matrix, countSum, pct)
bact_matrix<-bact_matrix%>%
arrange(desc(pct))
bact_matrix<-bact_matrix%>%
mutate(cumpct=cumsum(pct))
dim(bact_matrix)
#group vectors for non bactloadCorrected datasets
num_groups<-c(1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3)
label_groups<-c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci")
#head(bact_matrix)
#creeate plot and delete columns with cumpct, pct and cumsum
nmds<-metaMDS(t(bact_matrix[,-c(45:47)]), try=50)
plot(nmds, type = "t", display="sites")
points(nmds, col=num_groups, cex=1.5, pch=16)
ordispider(nmds, label_groups, label=T)
bact_matrix<-bact_matrix[bact_matrix$countSum >=50,]
#head(bact_matrix)
#creeate plot and delete columns with cumpct, pct and cumsum
nmds<-metaMDS(t(bact_matrix[,-c(45:47)]), try=50)
plot(nmds, type = "t", display="sites")
points(nmds, col=num_groups, cex=1.5, pch=16)
ordispider(nmds, label_groups, label=T)
#vector
species_vector<-data.frame(Species=c("Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tau","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tme","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci","Tci"))
bact_cca<-cca(t(bact_matrix[,-c(45:47)])~Species, data=species_vector)
plot(bact_cca, type="t", display="sites")
points(bact_cca, col=num_groups, cex=1.5, pch=16)
ordispider(bact_cca, label_groups, label=T)
summary(bact_cca)
anova(bact_cca)
anova(bact_cca, by="term")
anova(bact_cca, by="margin")
#cca with all core species inclusive (core of any of the species).
coreOTUs<-c("OTU_1058", "OTU_11","OTU_124","OTU_132","OTU_19", "OTU_21", "OTU_242", "OTU_25","OTU_27","OTU_36", "OTU_360", "OTU_43","OTU_455",
"OTU_52","OTU_54","OTU_65","OTU_73","OTU_75","OTU_77","OTU_888","OTU_9","OTU_90","OTU_91","OTU_96")
coreOnlyCounts<-bact_matrix[rownames(bact_matrix[,-c(45:47)]) %in% as.character(coreOTUs),-c(45:47)]
core_cca<-cca(t(coreOnlyCounts)~Species, data=species_vector)#correspondence analysis,
plot(core_cca, type="t", display="sites")
points(core_cca, col=num_groups, cex=1.5, pch=16)
ordispider(core_cca, label_groups, label=T)
anova(core_cca)
#cca with non-core community OTUs (those not included in the all core species in any species)
nonCoreCounts<-bact_matrix[!(rownames(bact_matrix[,-c(45:47)]) %in% as.character(coreOTUs)),-c(45:47)]
nonCore_cca<-cca(t(nonCoreCounts)~Species, data=species_vector)
plot(nonCore_cca, type="t", display="sites")
points(nonCore_cca, col=num_groups, cex=1.5, pch=16)
ordispider(nonCore_cca, label_groups, label=T)
anova(nonCore_cca)
is.matrix(bact_matrix)
xbact_matrix<-as.matrix(bact_matrix)
bact_matrix_rMeans<-rowMeans(xbact_matrix[,-c(45:47)])
bact_matrix_rSds<-rowSds(xbact_matrix[,-c(45:47)])
bact_matrix_zscores<-((xbact_matrix[,-c(45:47)]-bact_matrix_rMeans)/bact_matrix_rSds)
OTUVars<-sort(rowVars(xbact_matrix[,-c(45:47)],useNames = T),decreasing = T)
variableOTUs<-names(head(OTUVars, n=25L))
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue"))
variableOTUs<-names(head(OTUVars, n=44L))
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue"))
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
variableOTUs<-names(head(OTUVars, n=25L))
variableOTUs<-names(head(OTUVars, n=25))
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
variableOTUs<-names(head(OTUVars, n=25L))
OTUVars<-sort(rowVars(xbact_matrix[,-c(45:47)],useNames = T),decreasing = T)
variableOTUs<-names(head(OTUVars, n=25L))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]))#,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
OTUVars<-sort(rowVars(xbact_matrix[,-c(45:47)],useNames = T),decreasing = T)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]))#,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
xyz<-bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]))
xyz<-bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,])
xyz<-bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]
heatmap(xyz)
heatmap(as.matrix(xyz))
View(xyz)
heatmap(as.matrix(names(xyz)))
matrix_zscores[rownames(matrix_zscores) %in% variableOTUs,]
vegemite(t(coreOnlyCounts), core_cca, scale = "log")
#highly variable otus
head(bact_matrix)
is.matrix(bact_matrix)
xbact_matrix<-as.matrix(bact_matrix)
bact_matrix_rMeans<-rowMeans(xbact_matrix[,-c(45:47)])
bact_matrix_rSds<-rowSds(xbact_matrix[,-c(45:47)])
bact_matrix_zscores<-((xbact_matrix[,-c(45:47)]-bact_matrix_rMeans)/bact_matrix_rSds)
OTUVars<-sort(rowVars(xbact_matrix[,-c(45:47)],useNames = T),decreasing = T)
variableOTUs<-names(head(OTUVars, n=25L))
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
bact_matrix<-read.csv(matrix_file, head=T, sep="\t", row.names=1)
countSum<-apply(bact_matrix,1,sum)#sum the rows
pct<-countSum/sum(countSum)
bact_matrix<-cbind(bact_matrix, countSum, pct)
bact_matrix<-bact_matrix%>%
arrange(desc(pct))
bact_matrix<-bact_matrix%>%
mutate(cumpct=cumsum(pct))
dim(bact_matrix)
View(bact_matrix)
bact_matrix<-bact_matrix[bact_matrix$countSum >=50,]
is.matrix(bact_matrix)
xbact_matrix<-as.matrix(bact_matrix[,-c(45:47)])
bact_matrix_rMeans<-rowMeans(xbact_matrix)
bact_matrix_rSds<-rowSds(xbact_matrix)
bact_matrix_zscores<-((xbact_matrix-bact_matrix_rMeans)/bact_matrix_rSds)
#highly variable otus
head(xbact_matrix)
OTUVars<-sort(rowVars(xbact_matrix,useNames = T),decreasing = T)
variableOTUs<-names(head(OTUVars, n=25L))
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
View(bact_matrix)
tiff("./Figures/AS_16splots/heatmap_variabilitu_16s_allotus.tiff",height=30,width=30,units="cm",res=300)
heatmap(as.matrix(bact_matrix_zscores),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
dev.off()
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]))#,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
variableOTUs<-names(head(OTUVars, n=25L))
OTUVars<-sort(rowVars(xbact_matrix,useNames = T),decreasing = T)
variableOTUs<-names(head(OTUVars, n=25L))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]))#,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
variableOTUs<-names(head(arrange(rowVars(xbact_matrix)), n=25L))
variability<-rowVars(xbact_matrix)
OTUVarscbind(xbact_matrix,variability)
OTUVars<-cbind(xbact_matrix,variability)
OTUVars<-sort(rowVars(bact_matrix,useNames = T),decreasing = T)
variability<-rowVars(bact_matrix)
variability<-rowVars(xbact_matrix)
OTUVars<-cbind(bact_matrix,variability)
arrange(OTUVars,by="variability")
OTUVars<-arrange(OTUVars,by="variability")
variableOTUs<-names(head(OTUVars, n=25L))
View(OTUVars)
variableOTUs<-rownames(head(OTUVars, n=25L))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]))#,ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
tiff("./Figures/AS_16splots/heatmap_25mostvariable_otus.tiff",height=30,width=30,units="cm",res=300)
heatmap(as.matrix(bact_matrix_zscores[rownames(bact_matrix_zscores) %in% variableOTUs,]),ColSideColors = c("green","green","green","green","green","green","green","green","green","green","green","red","red","red","red","red","red","red","red","red","red","red","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue","blue"))
dev.off()
